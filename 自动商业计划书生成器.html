<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒç«™æ¶²å†·è¶…å……é¡¹ç›® - è‡ªåŠ¨å•†ä¸šè®¡åˆ’ä¹¦ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="åº“é‡Œè“æš—å¤œä¸»é¢˜.css">
    <style>
        /* è‡ªåŠ¨ç”Ÿæˆå™¨ç‰¹æœ‰æ ·å¼ */
        .generator-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .workflow-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }

        .workflow-steps::before {
            content: '';
            position: absolute;
            top: 25px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: linear-gradient(90deg, #0077C0, #FFC72C);
            z-index: 0;
        }

        .step {
            background: rgba(26, 35, 71, 0.9);
            border: 2px solid rgba(0, 119, 192, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            width: 200px;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }

        .step.active {
            border-color: #FFC72C;
            background: rgba(29, 66, 138, 0.95);
            box-shadow: 0 8px 25px rgba(255, 199, 44, 0.3);
        }

        .step.completed {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #1D428A, #0077C0);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #FFC72C, #FFD700);
            animation: pulse 2s infinite;
        }

        .step.completed .step-number {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }

        .step-title {
            font-size: 16px;
            font-weight: 600;
            color: #FFFFFF;
            margin-bottom: 8px;
        }

        .step-description {
            font-size: 12px;
            color: #B8C5D6;
            line-height: 1.4;
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .config-panel {
            background: rgba(26, 35, 71, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(0, 119, 192, 0.3);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .preview-panel {
            background: rgba(26, 35, 71, 0.7);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(0, 119, 192, 0.3);
            min-height: 800px;
        }

        .template-selector {
            margin-bottom: 30px;
        }

        .template-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .template-option {
            background: rgba(29, 66, 138, 0.3);
            border: 2px solid rgba(0, 119, 192, 0.3);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .template-option:hover {
            border-color: #FFC72C;
            transform: translateY(-2px);
        }

        .template-option.selected {
            border-color: #FFC72C;
            background: rgba(255, 199, 44, 0.1);
            box-shadow: 0 4px 15px rgba(255, 199, 44, 0.3);
        }

        .template-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .template-name {
            font-size: 14px;
            font-weight: 600;
            color: #FFFFFF;
            margin-bottom: 5px;
        }

        .template-desc {
            font-size: 12px;
            color: #B8C5D6;
        }

        .section-config {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #FFFFFF;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(29, 66, 138, 0.2);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(29, 66, 138, 0.4);
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #FFC72C;
        }

        .checkbox-item label {
            color: #B8C5D6;
            cursor: pointer;
            flex: 1;
            font-size: 14px;
        }

        .customization-options {
            margin-top: 20px;
        }

        .color-scheme-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .color-scheme {
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .color-scheme:hover {
            transform: scale(1.05);
        }

        .color-scheme.selected {
            border-color: #FFC72C;
            box-shadow: 0 0 15px rgba(255, 199, 44, 0.5);
        }

        .scheme-blue {
            background: linear-gradient(135deg, #1D428A, #0077C0);
            color: white;
        }

        .scheme-green {
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            color: white;
        }

        .scheme-purple {
            background: linear-gradient(135deg, #6A1B9A, #9C27B0);
            color: white;
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #1D428A, #0077C0);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            box-shadow: 0 6px 20px rgba(0, 119, 192, 0.4);
            position: relative;
            overflow: hidden;
        }

        .generate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .generate-btn:hover::before {
            left: 100%;
        }

        .generate-btn:hover {
            background: linear-gradient(135deg, #0077C0, #1D428A);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 119, 192, 0.5);
        }

        .generate-btn:disabled {
            background: rgba(107, 114, 128, 0.5);
            cursor: not-allowed;
            transform: none;
        }

        .preview-content {
            background: white;
            border-radius: 10px;
            padding: 40px;
            min-height: 700px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .preview-header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #1D428A;
            padding-bottom: 30px;
        }

        .preview-title {
            font-size: 36px;
            font-weight: bold;
            color: #1D428A;
            margin-bottom: 15px;
        }

        .preview-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }

        .preview-meta {
            font-size: 14px;
            color: #999;
        }

        .preview-section {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }

        .preview-section-title {
            font-size: 24px;
            font-weight: bold;
            color: #1D428A;
            margin-bottom: 15px;
            border-left: 5px solid #0077C0;
            padding-left: 15px;
        }

        .preview-data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .preview-data-card {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .preview-data-value {
            font-size: 24px;
            font-weight: bold;
            color: #1D428A;
            margin-bottom: 5px;
        }

        .preview-data-label {
            font-size: 14px;
            color: #6b7280;
        }

        .export-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .export-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .export-pdf {
            background: linear-gradient(135deg, #1D428A, #0077C0);
            color: white;
        }

        .export-word {
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            color: white;
        }

        .export-excel {
            background: linear-gradient(135deg, #1565C0, #42A5F5);
            color: white;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .progress-bar {
            display: none;
            width: 100%;
            height: 6px;
            background: rgba(26, 35, 71, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1D428A, #0077C0, #FFC72C);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        .status-message {
            display: none;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: 500;
        }

        .status-success {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }

        .status-error {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #F44336;
        }

        .status-info {
            background: rgba(33, 150, 243, 0.1);
            border: 1px solid rgba(33, 150, 243, 0.3);
            color: #2196F3;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .config-panel {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .workflow-steps {
                flex-direction: column;
                gap: 20px;
            }

            .workflow-steps::before {
                display: none;
            }

            .step {
                width: 100%;
            }

            .template-options {
                grid-template-columns: 1fr;
            }

            .color-scheme-selector {
                grid-template-columns: 1fr;
            }
        }

        /* å›¾è¡¨å’Œå›¾ç‰‡æ ·å¼ */
        .chart-container {
            margin: 20px 0;
            padding: 15px;
            background: rgba(29, 66, 138, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 119, 192, 0.2);
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: #1D428A;
            margin-bottom: 12px;
            text-align: center;
        }

        .chart-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            background: white;
            border-radius: 8px;
            padding: 10px;
            min-height: 200px;
        }

        .chart-wrapper canvas {
            max-width: 100%;
            height: auto;
        }

        .image-container {
            margin: 20px 0;
            padding: 15px;
            background: rgba(29, 66, 138, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 119, 192, 0.2);
        }

        .image-title {
            font-size: 16px;
            font-weight: 600;
            color: #1D428A;
            margin-bottom: 12px;
            text-align: center;
        }

        .image-wrapper {
            text-align: center;
            background: white;
            border-radius: 8px;
            padding: 15px;
        }

        .content-image {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .content-image:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .image-caption {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            font-style: italic;
            line-height: 1.4;
        }

        .tech-images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .tech-images-grid {
                grid-template-columns: 1fr;
            }

            .chart-wrapper canvas {
                width: 100%;
                height: 150px;
            }
        }

        /* å›¾è¡¨åŠ è½½åŠ¨ç”» */
        @keyframes chartLoading {
            0% { opacity: 0.3; }
            50% { opacity: 0.7; }
            100% { opacity: 0.3; }
        }

        .chart-loading {
            animation: chartLoading 1.5s ease-in-out infinite;
        }

        /* å›¾ç‰‡é”™è¯¯çŠ¶æ€ */
        .content-image.error {
            display: none;
        }

        .image-error {
            padding: 20px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            text-align: center;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="generator-container">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <div class="header-section fade-in">
            <div class="header">
                <h1 class="title">è‡ªåŠ¨å•†ä¸šè®¡åˆ’ä¹¦ç”Ÿæˆå™¨</h1>
                <p class="subtitle">å‚æ•°é©±åŠ¨ Â· å®æ—¶ç”Ÿæˆ Â· å¤šæ ¼å¼å¯¼å‡º</p>
            </div>
        </div>

        <!-- å·¥ä½œæµç¨‹æ­¥éª¤ -->
        <div class="workflow-steps">
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <div class="step-title">å‚æ•°é…ç½®</div>
                <div class="step-description">è®¾ç½®é¡¹ç›®åŸºç¡€å‚æ•°å’Œè´¢åŠ¡æ¨¡å‹</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div class="step-title">æ¨¡æ¿é€‰æ‹©</div>
                <div class="step-description">é€‰æ‹©å•†ä¸šè®¡åˆ’ä¹¦æ¨¡æ¿å’Œæ ·å¼</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div class="step-title">ç”Ÿæˆé¢„è§ˆ</div>
                <div class="step-description">å®æ—¶ç”Ÿæˆå¹¶é¢„è§ˆå•†ä¸šè®¡åˆ’ä¹¦</div>
            </div>
            <div class="step" id="step4">
                <div class="step-number">4</div>
                <div class="step-title">å¯¼å‡ºä¸‹è½½</div>
                <div class="step-description">æ”¯æŒPDFã€Wordã€Excelå¤šæ ¼å¼å¯¼å‡º</div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- é…ç½®é¢æ¿ -->
            <div class="config-panel">
                <!-- æ¨¡æ¿é€‰æ‹© -->
                <div class="template-selector">
                    <div class="section-title">
                        <span>ğŸ“„</span>
                        <span>é€‰æ‹©æ¨¡æ¿</span>
                    </div>
                    <div class="template-options">
                        <div class="template-option selected" onclick="selectTemplate('investor')">
                            <div class="template-icon">ğŸ’¼</div>
                            <div class="template-name">æŠ•èµ„è€…ç‰ˆ</div>
                            <div class="template-desc">ä¸“ä¸šæŠ•èµ„å±•ç¤º</div>
                        </div>
                        <div class="template-option" onclick="selectTemplate('bank')">
                            <div class="template-icon">ğŸ¦</div>
                            <div class="template-name">é“¶è¡Œèèµ„ç‰ˆ</div>
                            <div class="template-desc">è´·æ¬¾ç”³è¯·ä¸“ç”¨</div>
                        </div>
                        <div class="template-option" onclick="selectTemplate('government')">
                            <div class="template-icon">ğŸ›ï¸</div>
                            <div class="template-name">æ”¿åºœç”³æŠ¥ç‰ˆ</div>
                            <div class="template-desc">æ”¿ç­–èµ„é‡‘ç”³è¯·</div>
                        </div>
                        <div class="template-option" onclick="selectTemplate('partner')">
                            <div class="template-icon">ğŸ¤</div>
                            <div class="template-name">åˆä½œæ´½è°ˆç‰ˆ</div>
                            <div class="template-desc">ä¸šåŠ¡åˆä½œå±•ç¤º</div>
                        </div>
                    </div>
                </div>

                <!-- å†…å®¹é…ç½® -->
                <div class="section-config">
                    <div class="section-title">
                        <span>ğŸ“‹</span>
                        <span>å†…å®¹é…ç½®</span>
                    </div>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="execSummary" checked>
                            <label for="execSummary">æ‰§è¡Œæ‘˜è¦</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="marketAnalysis" checked>
                            <label for="marketAnalysis">å¸‚åœºåˆ†æ</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="technicalPlan" checked>
                            <label for="technicalPlan">æŠ€æœ¯æ–¹æ¡ˆ</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="financialModel" checked>
                            <label for="financialModel">è´¢åŠ¡æ¨¡å‹</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="riskAssessment" checked>
                            <label for="riskAssessment">é£é™©è¯„ä¼°</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="teamIntro" checked>
                            <label for="teamIntro">å›¢é˜Ÿä»‹ç»</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="implementationPlan">
                            <label for="implementationPlan">å®æ–½è®¡åˆ’</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="appendix">
                            <label for="appendix">é™„å½•èµ„æ–™</label>
                        </div>
                    </div>
                </div>

                <!-- æ ·å¼é…ç½® -->
                <div class="customization-options">
                    <div class="section-title">
                        <span>ğŸ¨</span>
                        <span>é…è‰²æ–¹æ¡ˆ</span>
                    </div>
                    <div class="color-scheme-selector">
                        <div class="color-scheme scheme-blue selected" onclick="selectColorScheme('blue')">
                            åº“é‡Œè“
                        </div>
                        <div class="color-scheme scheme-green" onclick="selectColorScheme('green')">
                            å•†åŠ¡ç»¿
                        </div>
                        <div class="color-scheme scheme-purple" onclick="selectColorScheme('purple')">
                            ç§‘æŠ€ç´«
                        </div>
                    </div>
                </div>

                <!-- ç”ŸæˆæŒ‰é’® -->
                <button class="generate-btn" onclick="generateBusinessPlan()">
                    <span>ğŸš€ ç”Ÿæˆå•†ä¸šè®¡åˆ’ä¹¦</span>
                </button>

                <!-- è¿›åº¦æ¡ -->
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>

                <!-- çŠ¶æ€æ¶ˆæ¯ -->
                <div class="status-message" id="statusMessage"></div>
            </div>

            <!-- é¢„è§ˆé¢æ¿ -->
            <div class="preview-panel">
                <div class="preview-content" id="previewContent">
                    <!-- é¢„è§ˆå¤´éƒ¨ -->
                    <div class="preview-header">
                        <h1 class="preview-title" id="previewTitle">åƒç«™æ¶²å†·è¶…å……é¡¹ç›®</h1>
                        <h2 class="preview-subtitle" id="previewSubtitle">å•†ä¸šè®¡åˆ’ä¹¦</h2>
                        <p class="preview-meta" id="previewMeta">æ·±åœ³å¸‚è¶…ç®—åŠ›é‡ç§‘æŠ€æœ‰é™å…¬å¸ | 2025å¹´10æœˆ</p>
                    </div>

                    <!-- æ‰§è¡Œæ‘˜è¦ -->
                    <div class="preview-section" id="execSummarySection">
                        <h3 class="preview-section-title">æ‰§è¡Œæ‘˜è¦</h3>
                        <p><strong>é¡¹ç›®æ¦‚è¿°ï¼š</strong>åƒç«™æ¶²å†·è¶…å……é¡¹ç›®è®¡åˆ’æŠ•èµ„28äº¿å…ƒäººæ°‘å¸ï¼Œåœ¨5å¹´å†…å»ºè®¾1000åº§åä¸ºæ¶²å†·è¶…å……ç«™ï¼Œæ€»åŠŸç‡7200kW/ç«™ã€‚é¡¹ç›®é‡‡ç”¨å…¨çƒé¢†å…ˆçš„600kWæ¶²å†·è¶…å……æŠ€æœ¯ï¼Œå®ç°"ä¸€ç§’ä¸€å…¬é‡Œ"çš„å……ç”µé€Ÿåº¦ï¼Œä¸ºæ–°èƒ½æºè½¦ä¸»æä¾›æè‡´å……ç”µä½“éªŒã€‚</p>

                        <div class="preview-data-grid">
                            <div class="preview-data-card">
                                <div class="preview-data-value" id="paramInvestment">28äº¿å…ƒ</div>
                                <div class="preview-data-label">æ€»æŠ•èµ„è§„æ¨¡</div>
                            </div>
                            <div class="preview-data-card">
                                <div class="preview-data-value" id="paramStations">1000åº§</div>
                                <div class="preview-data-label">å……ç”µç«™æ•°é‡</div>
                            </div>
                            <div class="preview-data-card">
                                <div class="preview-data-value" id="paramIRR">42.8%</div>
                                <div class="preview-data-label">é¡¹ç›®IRR</div>
                            </div>
                            <div class="preview-data-card">
                                <div class="preview-data-value" id="paramPayback">4.5å¹´</div>
                                <div class="preview-data-label">æŠ•èµ„å›æ”¶æœŸ</div>
                            </div>
                        </div>

                        <p><strong>æŠ•èµ„äº®ç‚¹ï¼š</strong></p>
                        <ul>
                            <li>æŠ€æœ¯é¢†å…ˆï¼šåä¸ºæ¶²å†·è¶…å……æŠ€æœ¯ï¼ŒåŠŸç‡å¯†åº¦è¡Œä¸šç¬¬ä¸€</li>
                            <li>å¸‚åœºå·¨å¤§ï¼šå……ç”µæ¡©å¸‚åœºå¹´å¤åˆå¢é•¿ç‡35%</li>
                            <li>å›æŠ¥ä¸°åšï¼šé¡¹ç›®IRR 42.8%ï¼ŒæŠ•èµ„å›æ”¶æœŸ4.5å¹´</li>
                            <li>é€€å‡ºå¤šå…ƒï¼šIPOã€å¹¶è´­ã€REITsä¸‰é‡é€€å‡ºæœºåˆ¶</li>
                        </ul>
                    </div>

                    <!-- å¸‚åœºåˆ†æ -->
                    <div class="preview-section" id="marketAnalysisSection">
                        <h3 class="preview-section-title">å¸‚åœºåˆ†æ</h3>
                        <p><strong>è¡Œä¸šèƒŒæ™¯ï¼š</strong>ä¸­å›½æ–°èƒ½æºæ±½è½¦äº§ä¸šæ­£å¤„äºçˆ†å‘å¼å¢é•¿æœŸã€‚2023å¹´ä¸­å›½æ–°èƒ½æºæ±½è½¦é”€é‡è¾¾950ä¸‡è¾†ï¼Œæ¸—é€ç‡è¶…è¿‡35%ã€‚é¢„è®¡åˆ°2028å¹´ï¼Œä¸­å›½ç”µåŠ¨è½¦ä¿æœ‰é‡å°†è¾¾åˆ°7000ä¸‡è¾†ï¼Œå……ç”µæ¡©éœ€æ±‚å°†è¶…è¿‡3800ä¸‡ä¸ªã€‚</p>

                        <p><strong>å¸‚åœºè§„æ¨¡ï¼š</strong></p>
                        <ul>
                            <li>å…¨çƒå……ç”µæ¡©å¸‚åœºï¼šé¢„è®¡2030å¹´è¾¾1253.9äº¿ç¾å…ƒ</li>
                            <li>ä¸­å›½å¸‚åœºè§„æ¨¡ï¼šå å…¨çƒå¸‚åœºä»½é¢çš„67.4%</li>
                            <li>å¹´å¤åˆå¢é•¿ç‡ï¼š35%</li>
                            <li>è¶…å……å¸‚åœºï¼šä»2023å¹´çš„120äº¿å…ƒå¢é•¿è‡³2028å¹´çš„800äº¿å…ƒ</li>
                        </ul>

                        <!-- å¸‚åœºå›¾è¡¨å±•ç¤ºåŒºåŸŸ -->
                        <div class="chart-container">
                            <h4 class="chart-title">æ–°èƒ½æºæ±½è½¦å¸‚åœºå¢é•¿è¶‹åŠ¿</h4>
                            <div class="chart-wrapper">
                                <canvas id="marketGrowthChart" width="400" height="200"></canvas>
                            </div>
                        </div>

                        <div class="chart-container">
                            <h4 class="chart-title">å……ç”µæ¡©å¸‚åœºè§„æ¨¡é¢„æµ‹</h4>
                            <div class="chart-wrapper">
                                <canvas id="marketSizeChart" width="400" height="200"></canvas>
                            </div>
                        </div>

                        <!-- æŠ€æœ¯æ¶æ„å›¾ç‰‡å±•ç¤º -->
                        <div class="image-container">
                            <h4 class="image-title">æŠ€æœ¯æ¶æ„å›¾</h4>
                            <div class="image-wrapper">
                                <img src="ç³»ç»Ÿæ¶æ„å›¾.png" alt="ç³»ç»Ÿæ¶æ„å›¾" class="content-image" />
                                <p class="image-caption">åƒç«™æ¶²å†·è¶…å……ç³»ç»Ÿæ•´ä½“æ¶æ„å›¾</p>
                            </div>
                        </div>
                    </div>

                    <!-- æŠ€æœ¯æ–¹æ¡ˆ -->
                    <div class="preview-section" id="technicalPlanSection">
                        <h3 class="preview-section-title">æŠ€æœ¯æ–¹æ¡ˆ</h3>
                        <p><strong>æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p>
                        <ul>
                            <li>åŠŸç‡é¢†å…ˆï¼š600kWæ¶²å†·è¶…å……æŠ€æœ¯ï¼Œè¡Œä¸šæœ€é«˜åŠŸç‡</li>
                            <li>å……ç”µé€Ÿåº¦ï¼š"ä¸€ç§’ä¸€å…¬é‡Œ"ï¼Œ60å€äºä¼ ç»Ÿå……ç”µ</li>
                            <li>æ•ˆç‡æå‡ï¼šè½¬æ¢æ•ˆç‡>96%ï¼Œæ•£çƒ­æ•ˆç‡æå‡300%</li>
                            <li>ä½¿ç”¨å¯¿å‘½ï¼š15å¹´ä»¥ä¸Šè®¾è®¡å¯¿å‘½ï¼Œè¡Œä¸šå¹³å‡2å€</li>
                        </ul>

                        <!-- æŠ€æœ¯å›¾ç‰‡å±•ç¤ºåŒºåŸŸ -->
                        <div class="tech-images-grid">
                            <div class="image-container">
                                <h4 class="image-title">ç”µåŠ›ç³»ç»Ÿæ¶æ„</h4>
                                <div class="image-wrapper">
                                    <img src="ç”µåŠ›ç³»ç»Ÿæ¶æ„å›¾.png" alt="ç”µåŠ›ç³»ç»Ÿæ¶æ„å›¾" class="content-image" />
                                    <p class="image-caption">10kV/20kVç”µç½‘æ¥å…¥åŠé…ç”µç³»ç»Ÿ</p>
                                </div>
                            </div>

                            <div class="image-container">
                                <h4 class="image-title">æ¶²å†·ç³»ç»ŸåŸç†</h4>
                                <div class="image-wrapper">
                                    <img src="æ¶²å†·ç³»ç»ŸåŸç†å›¾.png" alt="æ¶²å†·ç³»ç»ŸåŸç†å›¾" class="content-image" />
                                    <p class="image-caption">æ¶²å†·æ•£çƒ­ç³»ç»Ÿå·¥ä½œåŸç†ç¤ºæ„å›¾</p>
                                </div>
                            </div>

                            <div class="image-container">
                                <h4 class="image-title">å……ç”µç«™å¸ƒå±€</h4>
                                <div class="image-wrapper">
                                    <img src="å……ç”µç«™å¸ƒå±€å›¾.png" alt="å……ç”µç«™å¸ƒå±€å›¾" class="content-image" />
                                    <p class="image-caption">è¶…çº§å……ç”µç«™æ ‡å‡†å¸ƒå±€è®¾è®¡</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è´¢åŠ¡æ¨¡å‹ -->
                    <div class="preview-section" id="financialModelSection">
                        <h3 class="preview-section-title">è´¢åŠ¡åˆ†æ</h3>
                        <div class="preview-data-grid">
                            <div class="preview-data-card">
                                <div class="preview-data-value" id="financialNPV">12.4äº¿</div>
                                <div class="preview-data-label">NPV@12%</div>
                            </div>
                            <div class="preview-data-card">
                                <div class="preview-data-value" id="financialProfit">121.9äº¿</div>
                                <div class="preview-data-label">10å¹´ç´¯è®¡åˆ©æ¶¦</div>
                            </div>
                            <div class="preview-data-card">
                                <div class="preview-data-value" id="financialROI">435%</div>
                                <div class="preview-data-label">æŠ•èµ„å›æŠ¥ç‡</div>
                            </div>
                            <div class="preview-data-card">
                                <div class="preview-data-value" id="financialMultiple">15-25å€</div>
                                <div class="preview-data-label">é¢„æœŸæ”¶ç›Šå€æ•°</div>
                            </div>
                        </div>

                        <!-- è´¢åŠ¡å›¾è¡¨å±•ç¤ºåŒºåŸŸ -->
                        <div class="chart-container">
                            <h4 class="chart-title">ç°é‡‘æµé¢„æµ‹å›¾è¡¨</h4>
                            <div class="chart-wrapper">
                                <canvas id="cashFlowChart" width="400" height="200"></canvas>
                            </div>
                        </div>

                        <div class="chart-container">
                            <h4 class="chart-title">æŠ•èµ„å›æŠ¥åˆ†æ</h4>
                            <div class="chart-wrapper">
                                <canvas id="roiChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- é£é™©è¯„ä¼° -->
                    <div class="preview-section" id="riskAssessmentSection">
                        <h3 class="preview-section-title">é£é™©è¯„ä¼°</h3>
                        <p><strong>é£é™©æ§åˆ¶æªæ–½ï¼š</strong></p>
                        <ul>
                            <li>æŠ€æœ¯é£é™©ï¼šåä¸ºæŠ€æœ¯æˆç†Ÿï¼ŒæŒç»­ç ”å‘æŠ•å…¥</li>
                            <li>å¸‚åœºé£é™©ï¼šå¤šå…ƒåŒ–å¸ƒå±€ï¼Œå¼¹æ€§å®šä»·ç­–ç•¥</li>
                            <li>æ”¿ç­–é£é™©ï¼šæ”¿åºœå…³ç³»ç»´æŠ¤ï¼Œæ”¿ç­–è·Ÿè¸ªæœºåˆ¶</li>
                            <li>è¿è¥é£é™©ï¼šæ™ºèƒ½åŒ–è¿ç»´ï¼Œæ ‡å‡†åŒ–ç®¡ç†</li>
                        </ul>
                    </div>
                </div>

                <!-- å¯¼å‡ºæ“ä½œ -->
                <div class="export-actions">
                    <button class="export-btn export-pdf" onclick="exportPDF()">
                        <span>ğŸ“„</span>
                        <span>å¯¼å‡ºPDF</span>
                    </button>
                    <button class="export-btn export-word" onclick="exportWord()">
                        <span>ğŸ“</span>
                        <span>å¯¼å‡ºWord</span>
                    </button>
                    <button class="export-btn export-excel" onclick="exportExcel()">
                        <span>ğŸ“Š</span>
                        <span>å¯¼å‡ºExcel</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentTemplate = 'investor';
        let currentColorScheme = 'blue';
        let businessPlanData = {};
        let generationInProgress = false;

        // å›¾è¡¨æ¸²æŸ“å‡½æ•°
        function renderCashFlowChart() {
            const canvas = document.getElementById('cashFlowChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);

            // è®¾ç½®å­—ä½“
            ctx.font = '12px "Microsoft YaHei", "PingFang SC", "Hiragino Sans GB", sans-serif';

            // æ•°æ®
            const years = ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5', 'Year 6', 'Year 7', 'Year 8', 'Year 9', 'Year 10'];
            const cashFlowData = [-28.0, 13.5, 14.8, 17.9, 21.3, 26.5, 28.9, 31.2, 33.8, 36.5];
            const cumulativeData = [-28.0, -14.5, 0.3, 18.2, 39.5, 66.0, 94.9, 126.1, 159.9, 196.4];

            // è®¾ç½®æ ·å¼
            const colors = {
                primary: '#1D428A',
                secondary: '#0077C0',
                accent: '#FFC72C',
                success: '#10B981',
                danger: '#EF4444'
            };

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(50, height - 40);
            ctx.lineTo(width - 30, height - 40);
            ctx.moveTo(50, 20);
            ctx.lineTo(50, height - 40);
            ctx.stroke();

            // ç»˜åˆ¶ç°é‡‘æµæŸ±çŠ¶å›¾
            const barWidth = (width - 100) / years.length * 0.6;
            const scale = (height - 80) / 50; // ç¼©æ”¾æ¯”ä¾‹

            cashFlowData.forEach((value, index) => {
                const x = 50 + (index * (width - 100) / years.length) + ((width - 100) / years.length - barWidth) / 2;
                const barHeight = Math.abs(value) * scale;
                const y = value >= 0 ? height - 40 - barHeight : height - 40;

                ctx.fillStyle = value >= 0 ? colors.success : colors.danger;
                ctx.fillRect(x, y, barWidth, barHeight);

                // ç»˜åˆ¶æ•°å€¼æ ‡ç­¾
                ctx.fillStyle = '#374151';
                ctx.font = '10px "Microsoft YaHei", "PingFang SC", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(value.toFixed(1), x + barWidth / 2, y - 5);
            });

            // ç»˜åˆ¶ç´¯è®¡ç°é‡‘æµæ›²çº¿
            ctx.strokeStyle = colors.primary;
            ctx.lineWidth = 2;
            ctx.beginPath();

            cumulativeData.forEach((value, index) => {
                const x = 50 + (index * (width - 100) / (years.length - 1));
                const y = height - 40 - (value + 30) * scale;

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // ç»˜åˆ¶Xè½´æ ‡ç­¾
            ctx.fillStyle = '#6b7280';
            ctx.font = '11px "Microsoft YaHei", "PingFang SC", sans-serif';
            ctx.textAlign = 'center';
            years.forEach((year, index) => {
                const x = 50 + (index * (width - 100) / years.length) + ((width - 100) / years.length) / 2;
                ctx.fillText(year, x, height - 25);
            });

            // æ·»åŠ å›¾ä¾‹
            ctx.fillStyle = colors.success;
            ctx.fillRect(width - 150, 10, 15, 10);
            ctx.fillStyle = '#374151';
            ctx.font = '12px "Microsoft YaHei", "PingFang SC", sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Annual Cash Flow', width - 130, 19);

            ctx.fillStyle = colors.primary;
            ctx.fillRect(width - 150, 25, 15, 2);
            ctx.fillText('Cumulative Cash Flow', width - 130, 29);
        }

        function renderROIChart() {
            const canvas = document.getElementById('roiChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);

            // æ•°æ®
            const scenarios = ['Conservative', 'Base', 'Optimistic'];
            const irrData = [35.6, 42.8, 50.2];
            const multipleData = [12.5, 18.3, 25.8];

            // è®¾ç½®æ ·å¼
            const colors = {
                primary: '#1D428A',
                secondary: '#0077C0',
                accent: '#FFC72C',
                success: '#10B981'
            };

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(60, height - 40);
            ctx.lineTo(width - 30, height - 40);
            ctx.moveTo(60, 20);
            ctx.lineTo(60, height - 40);
            ctx.stroke();

            // ç»˜åˆ¶IRRæŸ±çŠ¶å›¾
            const barWidth = 40;
            const spacing = (width - 120) / scenarios.length;
            const irrScale = (height - 80) / 60;

            irrData.forEach((value, index) => {
                const x = 60 + spacing * index + spacing / 2 - barWidth / 2;
                const barHeight = value * irrScale;
                const y = height - 40 - barHeight;

                // æ¸å˜å¡«å……
                const gradient = ctx.createLinearGradient(0, y, 0, height - 40);
                gradient.addColorStop(0, colors.primary);
                gradient.addColorStop(1, colors.secondary);
                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth, barHeight);

                // ç»˜åˆ¶æ•°å€¼æ ‡ç­¾
                ctx.fillStyle = '#374151';
                ctx.font = 'bold 12px "Microsoft YaHei", "PingFang SC", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(value + '%', x + barWidth / 2, y - 5);

                // ç»˜åˆ¶åœºæ™¯æ ‡ç­¾
                ctx.fillStyle = '#6b7280';
                ctx.font = '12px "Microsoft YaHei", "PingFang SC", sans-serif';
                ctx.fillText(scenarios[index], x + barWidth / 2, height - 25);
            });

            // æ·»åŠ æ ‡é¢˜å’Œå•ä½
            ctx.fillStyle = '#374151';
            ctx.font = 'bold 14px "Microsoft YaHei", "PingFang SC", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('IRR Comparison (%)', width / 2, 15);

            // ç»˜åˆ¶æ”¶ç›Šå€æ•°æŒ‡ç¤ºå™¨
            const multipleY = height - 70;
            ctx.font = '11px "Microsoft YaHei", "PingFang SC", sans-serif';
            ctx.textAlign = 'left';
            multipleData.forEach((value, index) => {
                const x = 60 + spacing * index + spacing / 2 - 30;
                ctx.fillStyle = colors.accent;
                ctx.fillText(`${value}x`, x, multipleY);
            });
        }

        function renderMarketGrowthChart() {
            const canvas = document.getElementById('marketGrowthChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);

            // æ•°æ®
            const years = ['2020', '2021', '2022', '2023', '2024', '2025', '2026', '2027', '2028'];
            const salesData = [137, 352, 689, 950, 1200, 1500, 1850, 2250, 2700];
            const penetrationData = [5.4, 13.4, 25.6, 35.2, 42.0, 48.5, 54.2, 59.8, 64.5];

            // è®¾ç½®æ ·å¼
            const colors = {
                primary: '#1D428A',
                secondary: '#0077C0',
                accent: '#FFC72C',
                success: '#10B981'
            };

            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(50, height - 60);
            ctx.lineTo(width - 30, height - 60);
            ctx.moveTo(50, 20);
            ctx.lineTo(50, height - 60);
            ctx.stroke();

            // ç»˜åˆ¶é”€é‡æ›²çº¿ï¼ˆå·¦è½´ï¼‰
            ctx.strokeStyle = colors.primary;
            ctx.lineWidth = 3;
            ctx.beginPath();

            const maxSales = Math.max(...salesData);
            const salesScale = (height - 100) / maxSales;

            salesData.forEach((value, index) => {
                const x = 50 + (index * (width - 100) / (years.length - 1));
                const y = height - 60 - value * salesScale;

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                // ç»˜åˆ¶æ•°æ®ç‚¹
                ctx.fillStyle = colors.primary;
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            });
            ctx.stroke();

            // ç»˜åˆ¶æ¸—é€ç‡æ›²çº¿ï¼ˆå³è½´ï¼‰
            ctx.strokeStyle = colors.success;
            ctx.lineWidth = 2;
            ctx.beginPath();

            const maxPenetration = Math.max(...penetrationData);
            const penetrationScale = (height - 100) / maxPenetration;

            penetrationData.forEach((value, index) => {
                const x = 50 + (index * (width - 100) / (years.length - 1));
                const y = height - 60 - value * penetrationScale;

                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                // ç»˜åˆ¶æ•°æ®ç‚¹
                ctx.fillStyle = colors.success;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, 2 * Math.PI);
                ctx.fill();
            });
            ctx.stroke();

            // ç»˜åˆ¶Xè½´æ ‡ç­¾
            ctx.fillStyle = '#6b7280';
            ctx.font = '10px "Microsoft YaHei", "PingFang SC", sans-serif';
            ctx.textAlign = 'center';
            years.forEach((year, index) => {
                const x = 50 + (index * (width - 100) / (years.length - 1));
                ctx.fillText(year, x, height - 45);
            });

            // æ·»åŠ Yè½´æ ‡ç­¾
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillStyle = colors.primary;
            ctx.font = '11px "Microsoft YaHei", "PingFang SC", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Sales (10K units)', 0, 0);
            ctx.restore();

            ctx.save();
            ctx.translate(width - 15, height / 2);
            ctx.rotate(Math.PI / 2);
            ctx.fillStyle = colors.success;
            ctx.font = '11px "Microsoft YaHei", "PingFang SC", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Penetration (%)', 0, 0);
            ctx.restore();

            // æ·»åŠ å›¾ä¾‹
            ctx.fillStyle = colors.primary;
            ctx.fillRect(width - 150, 10, 15, 3);
            ctx.fillStyle = '#374151';
            ctx.font = '11px "Microsoft YaHei", "PingFang SC", sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText('Sales (Left)', width - 130, 14);

            ctx.fillStyle = colors.success;
            ctx.fillRect(width - 150, 25, 15, 3);
            ctx.fillText('Penetration (Right)', width - 130, 29);
        }

        function renderMarketSizeChart() {
            const canvas = document.getElementById('marketSizeChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);

            // æ•°æ®
            const segments = ['Liquid Cooling', 'Fast Charging', 'Slow Charging', 'Others'];
            const marketData = [800, 1200, 600, 400];
            const colors = ['#1D428A', '#0077C0', '#10B981', '#FFC72C'];

            // ç»˜åˆ¶é¥¼å›¾
            const centerX = width / 2;
            const centerY = height / 2 - 10;
            const radius = Math.min(width, height) / 3;

            const total = marketData.reduce((sum, value) => sum + value, 0);
            let currentAngle = -Math.PI / 2;

            marketData.forEach((value, index) => {
                const sliceAngle = (value / total) * 2 * Math.PI;

                // ç»˜åˆ¶æ‰‡å½¢
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.lineTo(centerX, centerY);
                ctx.fillStyle = colors[index];
                ctx.fill();

                // ç»˜åˆ¶è¾¹æ¡†
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // ç»˜åˆ¶ç™¾åˆ†æ¯”æ ‡ç­¾
                const percentage = ((value / total) * 100).toFixed(1);
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
                const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);

                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(percentage + '%', labelX, labelY);

                currentAngle += sliceAngle;
            });

            // æ·»åŠ å›¾ä¾‹
            ctx.font = '11px "Microsoft YaHei", "PingFang SC", sans-serif';
            ctx.textAlign = 'left';

            segments.forEach((segment, index) => {
                const legendY = 20 + index * 20;
                ctx.fillStyle = colors[index];
                ctx.fillRect(10, legendY - 8, 12, 12);

                ctx.fillStyle = '#374151';
                ctx.fillText(`${segment}: ${marketData[index]}B RMB`, 28, legendY);
            });

            // æ·»åŠ æ ‡é¢˜
            ctx.fillStyle = '#374151';
            ctx.font = 'bold 12px "Microsoft YaHei", "PingFang SC", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('2028 Charging Market Forecast (Billion RMB)', width / 2, height - 10);
        }

        // å›¾ç‰‡é”™è¯¯å¤„ç†å‡½æ•°
        function handleImageError(img) {
            img.classList.add('error');
            const wrapper = img.parentElement;
            const errorDiv = document.createElement('div');
            errorDiv.className = 'image-error';
            errorDiv.innerHTML = 'å›¾ç‰‡åŠ è½½å¤±è´¥<br><small>' + img.alt + '</small>';
            wrapper.appendChild(errorDiv);
        }

        // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
        function initializeCharts() {
            // å»¶è¿Ÿæ¸²æŸ“ç¡®ä¿DOMå…ƒç´ å·²åˆ›å»º
            setTimeout(() => {
                renderCashFlowChart();
                renderROIChart();
                renderMarketGrowthChart();
                renderMarketSizeChart();

                // è®¾ç½®å›¾ç‰‡é”™è¯¯å¤„ç†
                document.querySelectorAll('.content-image').forEach(img => {
                    img.onerror = function() {
                        handleImageError(this);
                    };
                });
            }, 100);
        }

        // é€‰æ‹©æ¨¡æ¿
        function selectTemplate(template) {
            currentTemplate = template;

            // æ›´æ–°UIçŠ¶æ€
            document.querySelectorAll('.template-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            // æ›´æ–°é¢„è§ˆå†…å®¹
            updatePreviewForTemplate(template);
        }

        // é€‰æ‹©é…è‰²æ–¹æ¡ˆ
        function selectColorScheme(scheme) {
            currentColorScheme = scheme;

            // æ›´æ–°UIçŠ¶æ€
            document.querySelectorAll('.color-scheme').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');

            // åº”ç”¨é…è‰²åˆ°é¢„è§ˆ
            applyColorScheme(scheme);
        }

        // åº”ç”¨é…è‰²æ–¹æ¡ˆ
        function applyColorScheme(scheme) {
            const previewContent = document.getElementById('previewContent');
            const colorSchemes = {
                blue: {
                    primary: '#1D428A',
                    secondary: '#0077C0',
                    accent: '#FFC72C'
                },
                green: {
                    primary: '#2E7D32',
                    secondary: '#4CAF50',
                    accent: '#FFC107'
                },
                purple: {
                    primary: '#6A1B9A',
                    secondary: '#9C27B0',
                    accent: '#FFC72C'
                }
            };

            const colors = colorSchemes[scheme];

            // æ›´æ–°é¢„è§ˆåŒºåŸŸé¢œè‰²
            const styleSheet = document.createElement('style');
            styleSheet.textContent = `
                .preview-title { color: ${colors.primary} !important; }
                .preview-section-title { color: ${colors.primary} !important; border-left-color: ${colors.secondary} !important; }
                .preview-header { border-bottom-color: ${colors.primary} !important; }
                .preview-data-value { color: ${colors.primary} !important; }
            `;

            // ç§»é™¤æ—§çš„æ ·å¼
            const oldStyle = document.getElementById('dynamicColorStyle');
            if (oldStyle) {
                oldStyle.remove();
            }

            styleSheet.id = 'dynamicColorStyle';
            document.head.appendChild(styleSheet);
        }

        // æ›´æ–°æ¨¡æ¿é¢„è§ˆ
        function updatePreviewForTemplate(template) {
            const templates = {
                investor: {
                    title: 'åƒç«™æ¶²å†·è¶…å……é¡¹ç›®',
                    subtitle: 'å•†ä¸šè®¡åˆ’ä¹¦ï¼ˆæŠ•èµ„è€…ç‰ˆï¼‰',
                    meta: 'æ·±åœ³å¸‚è¶…ç®—åŠ›é‡ç§‘æŠ€æœ‰é™å…¬å¸ | 2025å¹´10æœˆ'
                },
                bank: {
                    title: 'åƒç«™æ¶²å†·è¶…å……é¡¹ç›®',
                    subtitle: 'èèµ„ç”³è¯·æŠ¥å‘Šï¼ˆé“¶è¡Œç‰ˆï¼‰',
                    meta: 'æ·±åœ³å¸‚è¶…ç®—åŠ›é‡ç§‘æŠ€æœ‰é™å…¬å¸ | 2025å¹´10æœˆ'
                },
                government: {
                    title: 'åƒç«™æ¶²å†·è¶…å……é¡¹ç›®',
                    subtitle: 'æ”¿ç­–èµ„é‡‘ç”³è¯·æŠ¥å‘Š',
                    meta: 'æ·±åœ³å¸‚è¶…ç®—åŠ›é‡ç§‘æŠ€æœ‰é™å…¬å¸ | 2025å¹´10æœˆ'
                },
                partner: {
                    title: 'åƒç«™æ¶²å†·è¶…å……é¡¹ç›®',
                    subtitle: 'ä¸šåŠ¡åˆä½œè®¡åˆ’ä¹¦',
                    meta: 'æ·±åœ³å¸‚è¶…ç®—åŠ›é‡ç§‘æŠ€æœ‰é™å…¬å¸ | 2025å¹´10æœˆ'
                }
            };

            const templateData = templates[template];
            document.getElementById('previewTitle').textContent = templateData.title;
            document.getElementById('previewSubtitle').textContent = templateData.subtitle;
            document.getElementById('previewMeta').textContent = templateData.meta;
        }

        // ç”Ÿæˆå•†ä¸šè®¡åˆ’ä¹¦
        async function generateBusinessPlan() {
            if (generationInProgress) return;

            generationInProgress = true;
            const generateBtn = document.querySelector('.generate-btn');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const statusMessage = document.getElementById('statusMessage');

            // ç¦ç”¨æŒ‰é’®
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<span>â³ æ­£åœ¨ç”Ÿæˆ...</span>';

            // æ˜¾ç¤ºè¿›åº¦æ¡
            progressBar.style.display = 'block';
            statusMessage.style.display = 'block';
            statusMessage.className = 'status-message status-info';
            statusMessage.textContent = 'æ­£åœ¨ç”Ÿæˆå•†ä¸šè®¡åˆ’ä¹¦...';

            try {
                // æ­¥éª¤1ï¼šæ”¶é›†é…ç½®å‚æ•°
                updateProgress(20);
                await sleep(500);
                statusMessage.textContent = 'æ­£åœ¨æ”¶é›†é…ç½®å‚æ•°...';

                const config = collectConfiguration();

                // æ­¥éª¤2ï¼šç”Ÿæˆå†…å®¹
                updateProgress(40);
                await sleep(500);
                statusMessage.textContent = 'æ­£åœ¨ç”Ÿæˆå†…å®¹...';

                const content = await generateContent(config);

                // æ­¥éª¤3ï¼šæ›´æ–°é¢„è§ˆ
                updateProgress(60);
                await sleep(500);
                statusMessage.textContent = 'æ­£åœ¨æ›´æ–°é¢„è§ˆ...';

                updatePreview(content);

                // æ­¥éª¤4ï¼šå®Œæˆç”Ÿæˆ
                updateProgress(80);
                await sleep(500);
                statusMessage.textContent = 'æ­£åœ¨ä¼˜åŒ–æ ¼å¼...';

                updateProgress(100);
                await sleep(300);

                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                statusMessage.className = 'status-message status-success';
                statusMessage.textContent = 'âœ… å•†ä¸šè®¡åˆ’ä¹¦ç”ŸæˆæˆåŠŸï¼';

                // æ›´æ–°å·¥ä½œæµç¨‹æ­¥éª¤
                updateWorkflowStep(3);

                // ä¿å­˜æ•°æ®
                businessPlanData = {
                    config: config,
                    content: content,
                    template: currentTemplate,
                    colorScheme: currentColorScheme,
                    generatedAt: new Date().toISOString()
                };

            } catch (error) {
                console.error('ç”Ÿæˆå•†ä¸šè®¡åˆ’ä¹¦æ—¶å‡ºé”™:', error);
                statusMessage.className = 'status-message status-error';
                statusMessage.textContent = 'âŒ ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•';
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                setTimeout(() => {
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = '<span>ğŸš€ ç”Ÿæˆå•†ä¸šè®¡åˆ’ä¹¦</span>';
                    progressBar.style.display = 'none';
                    progressFill.style.width = '0%';

                    // 3ç§’åéšè—çŠ¶æ€æ¶ˆæ¯
                    setTimeout(() => {
                        statusMessage.style.display = 'none';
                    }, 3000);

                    generationInProgress = false;
                }, 2000);
            }
        }

        // æ”¶é›†é…ç½®å‚æ•°
        function collectConfiguration() {
            const config = {
                template: currentTemplate,
                colorScheme: currentColorScheme,
                sections: [],
                parameters: {
                    investment: document.getElementById('paramInvestment')?.textContent || '28äº¿å…ƒ',
                    stations: document.getElementById('paramStations')?.textContent || '1000åº§',
                    irr: document.getElementById('paramIRR')?.textContent || '42.8%',
                    payback: document.getElementById('paramPayback')?.textContent || '4.5å¹´'
                }
            };

            // æ”¶é›†é€‰ä¸­çš„ç« èŠ‚
            const checkboxes = document.querySelectorAll('.checkbox-item input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    config.sections.push(checkbox.id);
                }
            });

            return config;
        }

        // ç”Ÿæˆå†…å®¹
        async function generateContent(config) {
            // è¿™é‡Œæ¨¡æ‹Ÿå†…å®¹ç”Ÿæˆè¿‡ç¨‹
            // å®é™…é¡¹ç›®ä¸­å¯ä»¥ä»æ•°æ®åº“æˆ–APIè·å–å†…å®¹
            const content = {
                title: 'åƒç«™æ¶²å†·è¶…å……é¡¹ç›®',
                subtitle: getTemplateSubtitle(config.template),
                sections: {}
            };

            // æ ¹æ®é€‰ä¸­çš„ç« èŠ‚ç”Ÿæˆå†…å®¹
            if (config.sections.includes('execSummary')) {
                content.sections.execSummary = generateExecutiveSummary(config);
            }

            if (config.sections.includes('marketAnalysis')) {
                content.sections.marketAnalysis = generateMarketAnalysis(config);
            }

            if (config.sections.includes('financialModel')) {
                content.sections.financialModel = generateFinancialModel(config);
            }

            return content;
        }

        // è·å–æ¨¡æ¿å‰¯æ ‡é¢˜
        function getTemplateSubtitle(template) {
            const subtitles = {
                investor: 'å•†ä¸šè®¡åˆ’ä¹¦ï¼ˆæŠ•èµ„è€…ç‰ˆï¼‰',
                bank: 'èèµ„ç”³è¯·æŠ¥å‘Šï¼ˆé“¶è¡Œç‰ˆï¼‰',
                government: 'æ”¿ç­–èµ„é‡‘ç”³è¯·æŠ¥å‘Š',
                partner: 'ä¸šåŠ¡åˆä½œè®¡åˆ’ä¹¦'
            };
            return subtitles[template] || 'å•†ä¸šè®¡åˆ’ä¹¦';
        }

        // ç”Ÿæˆæ‰§è¡Œæ‘˜è¦
        function generateExecutiveSummary(config) {
            return {
                title: 'æ‰§è¡Œæ‘˜è¦',
                content: `åƒç«™æ¶²å†·è¶…å……é¡¹ç›®è®¡åˆ’æŠ•èµ„${config.parameters.investment}ï¼Œå»ºè®¾${config.parameters.stations}åä¸ºæ¶²å†·è¶…å……ç«™ã€‚é¡¹ç›®IRRè¾¾${config.parameters.irr}ï¼ŒæŠ•èµ„å›æ”¶æœŸ${config.parameters.payback}ã€‚`
            };
        }

        // ç”Ÿæˆå¸‚åœºåˆ†æ
        function generateMarketAnalysis(config) {
            return {
                title: 'å¸‚åœºåˆ†æ',
                content: 'ä¸­å›½æ–°èƒ½æºæ±½è½¦å¸‚åœºå¿«é€Ÿå¢é•¿ï¼Œå……ç”µåŸºç¡€è®¾æ–½éœ€æ±‚æ—ºç››ï¼Œæ”¿ç­–å¤§åŠ›æ”¯æŒæ–°èƒ½æºäº§ä¸šå‘å±•ã€‚'
            };
        }

        // ç”Ÿæˆè´¢åŠ¡æ¨¡å‹
        function generateFinancialModel(config) {
            return {
                title: 'è´¢åŠ¡åˆ†æ',
                content: 'é¡¹ç›®è´¢åŠ¡æ¨¡å‹æ˜¾ç¤ºå…·æœ‰è‰¯å¥½çš„æŠ•èµ„å›æŠ¥ï¼Œç¬¦åˆæŠ•èµ„è€…é¢„æœŸã€‚'
            };
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview(content) {
            // è¿™é‡Œå¯ä»¥æ ¹æ®ç”Ÿæˆçš„contentæ›´æ–°é¢„è§ˆåŒºåŸŸ
            // ç›®å‰åªæ˜¯æ¨¡æ‹Ÿæ›´æ–°
            console.log('æ›´æ–°é¢„è§ˆ:', content);
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percentage) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percentage + '%';
        }

        // æ›´æ–°å·¥ä½œæµç¨‹æ­¥éª¤
        function updateWorkflowStep(stepNumber) {
            // æ ‡è®°å‰é¢çš„æ­¥éª¤ä¸ºå®Œæˆ
            for (let i = 1; i < stepNumber; i++) {
                const step = document.getElementById(`step${i}`);
                step.classList.remove('active');
                step.classList.add('completed');
            }

            // æ¿€æ´»å½“å‰æ­¥éª¤
            const currentStep = document.getElementById(`step${stepNumber}`);
            currentStep.classList.add('active');
            currentStep.classList.remove('completed');
        }

        // å¯¼å‡ºåŠŸèƒ½
        function exportPDF() {
            if (!businessPlanData.generatedAt) {
                alert('è¯·å…ˆç”Ÿæˆå•†ä¸šè®¡åˆ’ä¹¦');
                return;
            }

            updateWorkflowStep(4);

            // æ¨¡æ‹ŸPDFå¯¼å‡º
            showStatus('æ­£åœ¨å¯¼å‡ºPDFæ–‡ä»¶...', 'info');

            setTimeout(() => {
                // å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šè°ƒç”¨çœŸå®çš„PDFç”ŸæˆAPI
                const pdfContent = generatePDFContent();
                downloadFile(pdfContent, 'åƒç«™æ¶²å†·è¶…å……é¡¹ç›®_å•†ä¸šè®¡åˆ’ä¹¦.pdf', 'application/pdf');
                showStatus('âœ… PDFå¯¼å‡ºæˆåŠŸï¼', 'success');
            }, 2000);
        }

        function exportWord() {
            if (!businessPlanData.generatedAt) {
                alert('è¯·å…ˆç”Ÿæˆå•†ä¸šè®¡åˆ’ä¹¦');
                return;
            }

            showStatus('æ­£åœ¨å¯¼å‡ºWordæ–‡ä»¶...', 'info');

            setTimeout(() => {
                const wordContent = generateWordContent();
                downloadFile(wordContent, 'åƒç«™æ¶²å†·è¶…å……é¡¹ç›®_å•†ä¸šè®¡åˆ’ä¹¦.docx', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document');
                showStatus('âœ… Wordå¯¼å‡ºæˆåŠŸï¼', 'success');
            }, 2000);
        }

        function exportExcel() {
            if (!businessPlanData.generatedAt) {
                alert('è¯·å…ˆç”Ÿæˆå•†ä¸šè®¡åˆ’ä¹¦');
                return;
            }

            showStatus('æ­£åœ¨å¯¼å‡ºExcelæ–‡ä»¶...', 'info');

            setTimeout(() => {
                const excelContent = generateExcelContent();
                downloadFile(excelContent, 'åƒç«™æ¶²å†·è¶…å……é¡¹ç›®_è´¢åŠ¡æ•°æ®.xlsx', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
                showStatus('âœ… Excelå¯¼å‡ºæˆåŠŸï¼', 'success');
            }, 2000);
        }

        // ç”ŸæˆPDFå†…å®¹ï¼ˆæ¨¡æ‹Ÿï¼‰
        function generatePDFContent() {
            // å®é™…é¡¹ç›®ä¸­ä¼šä½¿ç”¨PDFç”Ÿæˆåº“
            return 'PDF content here';
        }

        // ç”ŸæˆWordå†…å®¹ï¼ˆæ¨¡æ‹Ÿï¼‰
        function generateWordContent() {
            // å®é™…é¡¹ç›®ä¸­ä¼šä½¿ç”¨Wordç”Ÿæˆåº“
            return 'Word content here';
        }

        // ç”ŸæˆExcelå†…å®¹ï¼ˆæ¨¡æ‹Ÿï¼‰
        function generateExcelContent() {
            // å®é™…é¡¹ç›®ä¸­ä¼šä½¿ç”¨Excelç”Ÿæˆåº“
            return 'Excel content here';
        }

        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(content, filename, contentType) {
            // å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šç”ŸæˆçœŸå®çš„æ–‡ä»¶å¹¶è§¦å‘ä¸‹è½½
            console.log(`ä¸‹è½½æ–‡ä»¶: ${filename}`);

            // åˆ›å»ºä¸‹è½½æç¤º
            const downloadLink = document.createElement('a');
            downloadLink.href = '#';
            downloadLink.download = filename;
            downloadLink.textContent = `ç‚¹å‡»ä¸‹è½½ ${filename}`;
            downloadLink.style.display = 'block';
            downloadLink.style.textAlign = 'center';
            downloadLink.style.marginTop = '20px';
            downloadLink.style.padding = '10px';
            downloadLink.style.background = 'rgba(76, 175, 80, 0.1)';
            downloadLink.style.border = '1px solid rgba(76, 175, 80, 0.3)';
            downloadLink.style.borderRadius = '8px';
            downloadLink.style.color = '#4CAF50';
            downloadLink.style.textDecoration = 'none';

            // ç§»é™¤æ—§çš„ä¸‹è½½é“¾æ¥
            const oldLink = document.querySelector('.download-link');
            if (oldLink) {
                oldLink.remove();
            }

            downloadLink.className = 'download-link';
            document.querySelector('.preview-panel').appendChild(downloadLink);
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type) {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.textContent = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.style.display = 'block';

            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        }

        // è¾…åŠ©å‡½æ•°ï¼šå»¶è¿Ÿ
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å·¥ä½œæµç¨‹
            updateWorkflowStep(1);

            // åˆå§‹åŒ–å›¾è¡¨
            initializeCharts();

            // ç›‘å¬å¤é€‰æ¡†å˜åŒ–
            const checkboxes = document.querySelectorAll('.checkbox-item input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const sectionId = this.id + 'Section';
                    const section = document.getElementById(sectionId);
                    if (section) {
                        section.style.display = this.checked ? 'block' : 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>