<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤äº’å¼è´¢åŠ¡è®¡ç®—å™¨</title>
    <link rel="stylesheet" href="åº“é‡Œè“æš—å¤œä¸»é¢˜.css">
    <style>
        /* äº¤äº’å¼è®¡ç®—å™¨ç‰¹æœ‰æ ·å¼ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .results-section {
            margin-bottom: 30px;
        }

        .parameters-section {
            margin-bottom: 30px;
        }

        .timing-parameters,
        .channel-parameters {
            background: rgba(26, 35, 71, 0.5);
            border: 1px solid rgba(0, 119, 192, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        select.input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(0, 119, 192, 0.4);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(26, 35, 71, 0.7);
            color: #FFFFFF;
            outline: none;
            cursor: pointer;
        }

        select.input-field:focus {
            border-color: #FFC72C;
            box-shadow: 0 0 15px rgba(255, 199, 44, 0.3);
            background: rgba(29, 66, 138, 0.9);
        }

        select.input-field option {
            background: #1A2347;
            color: #FFFFFF;
            padding: 10px;
        }

        .calculation-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .calculation-buttons .btn-primary {
            flex: 1;
            margin-top: 0;
            position: relative;
            overflow: hidden;
        }

        .calculation-buttons .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .calculation-buttons .btn-primary:hover::before {
            left: 100%;
        }

        .investment-calc-btn:disabled {
            background: linear-gradient(135deg, #666 0%, #888 100%);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .investment-calc-btn:disabled:hover {
            transform: none;
            background: linear-gradient(135deg, #666 0%, #888 100%);
            box-shadow: 0 4px 15px rgba(0, 119, 192, 0.3);
        }

        .investment-calc-btn:enabled {
            background: linear-gradient(135deg, #FFC72C 0%, #FFD700 100%);
            color: #1D428A;
            border-color: rgba(29, 66, 138, 0.3);
        }

        .investment-calc-btn:enabled:hover {
            background: linear-gradient(135deg, #FFD700 0%, #FFC72C 100%);
            border-color: #1D428A;
            box-shadow: 0 12px 30px rgba(255, 199, 44, 0.6);
        }

        .calculation-status {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: rgba(26, 35, 71, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(0, 119, 192, 0.3);
        }

        .status-text {
            color: #B8C5D6;
            font-size: 14px;
            font-weight: 500;
        }

        .status-text.success {
            color: #4CAF50;
        }

        .status-text.ready {
            color: #FFC72C;
        }

        .project-timing-info {
            margin: 20px 0;
        }

        .info-card {
            background: rgba(29, 66, 138, 0.8);
            border: 1px solid rgba(255, 199, 44, 0.4);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 119, 192, 0.3);
        }

        .info-card h4 {
            color: #FFC72C;
            font-size: 16px;
            margin: 0 0 15px 0;
            text-align: center;
            border-bottom: 1px solid rgba(255, 199, 44, 0.3);
            padding-bottom: 10px;
        }

        .timing-data {
            display: grid;
            gap: 12px;
        }

        .timing-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(26, 35, 71, 0.6);
            border-radius: 6px;
            border: 1px solid rgba(0, 119, 192, 0.2);
        }

        .timing-label {
            color: #B8C5D6;
            font-size: 14px;
        }

        .timing-value {
            color: #FFFFFF;
            font-weight: bold;
            font-size: 14px;
        }

        .timing-hint {
            display: block;
            margin-top: 5px;
            color: #FFC72C;
            font-size: 12px;
            text-align: center;
        }

        input[readonly] {
            background: rgba(26, 35, 71, 0.5) !important;
            cursor: not-allowed;
            opacity: 0.8;
        }

        input[readonly]:focus {
            border-color: rgba(0, 119, 192, 0.4) !important;
            box-shadow: none !important;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0, 119, 192, 0.5);
        }

        .section-icon {
            font-size: 24px;
        }

        .section-subtitle {
            font-size: 14px;
            color: #B8C5D6;
            margin-left: auto;
            opacity: 0.8;
        }

        .section-divider {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 25px 0;
            gap: 15px;
        }

        .divider-line {
            flex: 1;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 199, 44, 0.5), transparent);
        }

        .divider-text {
            background: linear-gradient(135deg, #1D428A 0%, #0077C0 100%);
            color: #FFC72C;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid rgba(255, 199, 44, 0.3);
            box-shadow: 0 4px 15px rgba(0, 119, 192, 0.3);
        }

        .divider-icon {
            font-size: 14px;
        }

        .chart-container {
            background: rgba(26, 35, 71, 0.7);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(0, 119, 192, 0.3);
        }

        .scenario-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
            background: rgba(26, 35, 71, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 119, 192, 0.2);
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #FFFFFF;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #B8C5D6;
            font-size: 12px;
            opacity: 0.8;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            background: rgba(26, 35, 71, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 119, 192, 0.3);
            margin-bottom: 30px;
            border: 1px solid rgba(0, 119, 192, 0.3);
        }

        .title {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(135deg, #FFFFFF 0%, #B8C5D6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 18px;
            color: #B8C5D6;
            margin-bottom: 20px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel {
            background: rgba(26, 35, 71, 0.9);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 119, 192, 0.3);
            border: 1px solid rgba(0, 119, 192, 0.3);
            transition: all 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 119, 192, 0.4);
            border-color: rgba(255, 199, 44, 0.5);
            background: rgba(29, 66, 138, 0.95);
        }

        .panel-title {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #FFFFFF 0%, #B8C5D6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid rgba(0, 119, 192, 0.5);
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-size: 14px;
            font-weight: bold;
            color: #FFFFFF;
            margin-bottom: 5px;
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-field {
            flex: 1;
            padding: 12px;
            border: 2px solid rgba(0, 119, 192, 0.4);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(26, 35, 71, 0.7);
            color: #FFFFFF;
            outline: none;
        }

        .input-field:focus {
            border-color: #FFC72C;
            box-shadow: 0 0 15px rgba(255, 199, 44, 0.3);
            background: rgba(29, 66, 138, 0.9);
        }

        .input-unit {
            font-size: 14px;
            color: #B8C5D6;
            min-width: 60px;
        }

        .input-slider {
            width: 100%;
            margin-top: 5px;
            appearance: none;
            height: 8px;
            border-radius: 4px;
            background: rgba(26, 35, 71, 0.7);
            outline: none;
            border: 1px solid rgba(0, 119, 192, 0.4);
        }

        .input-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFC72C 0%, #FFD700 100%);
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(255, 199, 44, 0.4);
            transition: all 0.3s ease;
        }

        .input-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 15px rgba(255, 199, 44, 0.6);
        }

        .input-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFC72C 0%, #FFD700 100%);
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(255, 199, 44, 0.4);
            transition: all 0.3s ease;
            border: none;
        }

        .input-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 15px rgba(255, 199, 44, 0.6);
        }

        .btn-primary {
            background: linear-gradient(135deg, #1D428A 0%, #0077C0 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 119, 192, 0.3);
            border: 1px solid rgba(0, 119, 192, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            background: linear-gradient(135deg, #0077C0 0%, #1D428A 100%);
            border-color: #FFC72C;
            box-shadow: 0 12px 30px rgba(255, 199, 44, 0.4);
        }

        .btn-secondary {
            background: rgba(26, 35, 71, 0.7);
            color: #B8C5D6;
            border: 1px solid rgba(0, 119, 192, 0.4);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(29, 66, 138, 0.9);
            color: white;
            border-color: #FFC72C;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 119, 192, 0.3);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: rgba(26, 35, 71, 0.7);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid rgba(0, 119, 192, 0.4);
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 119, 192, 0.2);
        }

        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(0, 119, 192, 0.3);
            border-color: rgba(255, 199, 44, 0.4);
            background: rgba(29, 66, 138, 0.8);
        }

        .result-value {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #FFC72C 0%, #FFD700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .result-label {
            font-size: 14px;
            color: #B8C5D6;
        }

        .result-highlight {
            background: rgba(29, 66, 138, 0.8);
            border-color: rgba(255, 199, 44, 0.6);
            box-shadow: 0 8px 32px rgba(255, 199, 44, 0.3);
        }

        .result-highlight .result-value {
            background: linear-gradient(135deg, #FFC72C 0%, #FFD700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 32px;
        }

        .chart-container {
            background: rgba(26, 35, 71, 0.9);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 119, 192, 0.3);
            margin-bottom: 30px;
            border: 1px solid rgba(0, 119, 192, 0.3);
            transition: all 0.3s ease;
        }

        .chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 60px rgba(0, 119, 192, 0.4);
            border-color: rgba(255, 199, 44, 0.5);
            background: rgba(29, 66, 138, 0.95);
        }

        .chart-title {
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(135deg, #FFFFFF 0%, #B8C5D6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-description {
            background: rgba(29, 66, 138, 0.6);
            border: 1px solid rgba(255, 199, 44, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 13px;
            line-height: 1.5;
        }

        .chart-description p {
            margin: 5px 0;
            color: #B8C5D6;
        }

        .chart-description strong {
            color: #FFC72C;
            font-weight: bold;
        }

        .simple-chart {
            height: 300px;
            position: relative;
            background: rgba(26, 35, 71, 0.5);
            border-radius: 10px;
            padding: 20px;
            overflow: hidden;
            border: 1px solid rgba(0, 119, 192, 0.2);
        }

        .bar-container {
            display: flex;
            align-items: end;
            justify-content: space-around;
            height: 200px;
            margin-top: 20px;
        }

        .bar {
            width: 60px;
            background: linear-gradient(to top, #0077C0, #1D428A);
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 119, 192, 0.4);
        }

        .bar:hover {
            transform: scaleY(1.05);
            background: linear-gradient(to top, #1D428A, #FFC72C);
            box-shadow: 0 8px 25px rgba(255, 199, 44, 0.5);
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #FFFFFF;
            white-space: nowrap;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: bold;
            color: #FFC72C;
            white-space: nowrap;
        }

        .section-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(0, 119, 192, 0.5);
            background: rgba(26, 35, 71, 0.3);
            border-radius: 10px 10px 0 0;
            padding: 10px;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            font-size: 16px;
            font-weight: bold;
            color: #B8C5D6;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            border-radius: 8px;
        }

        .tab.active {
            background: linear-gradient(135deg, #1D428A 0%, #0077C0 100%);
            color: #FFFFFF;
            border-bottom-color: #FFC72C;
            box-shadow: 0 4px 15px rgba(0, 119, 192, 0.4);
        }

        .tab:hover {
            color: #FFFFFF;
            background: rgba(29, 66, 138, 0.7);
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .formula-display {
            background: rgba(26, 35, 71, 0.7);
            border: 1px solid rgba(0, 119, 192, 0.4);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #B8C5D6;
        }

        .scenario-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background: rgba(26, 35, 71, 0.95);
            backdrop-filter: blur(20px);
            color: #FFFFFF;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            font-size: 12px;
            line-height: 1.4;
            border: 1px solid rgba(0, 119, 192, 0.4);
            box-shadow: 0 8px 25px rgba(0, 119, 192, 0.4);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }

            .panel {
                padding: 20px;
            }

            .header {
                padding: 20px 15px;
            }

            .title {
                font-size: 24px;
            }

            .subtitle {
                font-size: 16px;
            }

            .panel-title {
                font-size: 20px;
            }

            .section-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .section-subtitle {
                margin-left: 0;
                font-size: 12px;
            }

            .section-divider {
                flex-direction: column;
                gap: 10px;
                margin: 20px 0;
            }

            .divider-line {
                width: 100%;
                height: 1px;
            }

            .divider-text {
                font-size: 11px;
                padding: 6px 12px;
            }

            .scenario-buttons {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }

            .btn-secondary {
                width: 100%;
                max-width: 200px;
            }

            .section-tabs {
                flex-direction: column;
                gap: 5px;
            }

            .tab {
                text-align: center;
                padding: 10px 15px;
            }

            .result-value {
                font-size: 24px;
            }

            .result-highlight .result-value {
                font-size: 28px;
            }

            .chart-container {
                padding: 20px;
            }

            .simple-chart {
                height: 250px;
                padding: 15px;
            }

            .bar {
                width: 40px;
            }

            .bar-label, .bar-value {
                font-size: 10px;
            }

            .results-section {
                margin-bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }

            .header {
                padding: 15px 10px;
            }

            .title {
                font-size: 20px;
            }

            .subtitle {
                font-size: 14px;
            }

            .panel {
                padding: 15px;
            }

            .panel-title {
                font-size: 18px;
            }

            .section-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .section-icon {
                font-size: 20px;
            }

            .section-subtitle {
                font-size: 11px;
                margin-left: 0;
            }

            .divider-text {
                font-size: 10px;
                padding: 4px 8px;
            }

            .result-value {
                font-size: 20px;
            }

            .result-highlight .result-value {
                font-size: 24px;
            }

            .simple-chart {
                height: 200px;
                padding: 10px;
            }

            .bar {
                width: 30px;
            }

            .bar-label, .bar-value {
                font-size: 9px;
            }

            .results-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 12px;
            }

            .results-section {
                margin-bottom: 15px;
            }

            .section-divider {
                margin: 15px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">äº¤äº’å¼è´¢åŠ¡è®¡ç®—å™¨</h1>
            <p class="subtitle">ğŸ§®æŠ•èµ„è€…è‡ªå®šä¹‰åˆ†æå·¥å…·</p>
            <div class="scenario-buttons">
                <button class="btn-secondary" onclick="loadScenario('conservative')">ğŸ˜Ÿ æ‚²è§‚æƒ…æ™¯</button>
                <button class="btn-secondary" onclick="loadScenario('base')">ğŸ“Š åŸºå‡†æƒ…æ™¯</button>
                <button class="btn-secondary" onclick="loadScenario('optimistic')">ğŸ˜Š ä¹è§‚æƒ…æ™¯</button>
                <button class="btn-secondary" onclick="resetParameters()">ğŸ”„ é‡ç½®å‚æ•°</button>
            </div>
        </div>

        <div class="main-content">
            <!-- å‚æ•°è¾“å…¥é¢æ¿ -->
            <div class="panel">
                <h2 class="panel-title">ğŸ“ å‚æ•°è®¾ç½®</h2>

                <!-- é¡¹ç›®å‚æ•°è®¾ç½®æ¨¡å— -->
                <div class="parameters-section">
                    <h3 class="section-title">
                        <span class="section-icon">ğŸ¢</span>
                        é¡¹ç›®å‚æ•°è®¾ç½®
                        <span class="section-subtitle">å½±å“é¡¹ç›®æ•´ä½“è¿è¥è¡¨ç°</span>
                    </h3>

                    <div class="section-tabs">
                        <button class="tab active" onclick="switchProjectTab('market')">å¸‚åœºå‚æ•°</button>
                        <button class="tab" onclick="switchProjectTab('operation')">è¿è¥å‚æ•°</button>
                        <button class="tab" onclick="switchProjectTab('cost')">æˆæœ¬å‚æ•°</button>
                        <button class="tab" onclick="switchProjectTab('production')">æŠ•äº§å‚æ•°</button>
                        <button class="tab" onclick="switchProjectTab('decision')">å…¬å¸å†³ç­–</button>
                    </div>

                    <!-- å¸‚åœºå‚æ•° -->
                    <div id="market-tab" class="tab-content active">
                        <div class="input-group">
                            <label class="input-label">
                                åŸºç¡€ç”µåŠ¨è½¦ä¿æœ‰é‡ (2023å¹´)
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">2023å¹´ä¸­å›½çº¯ç”µåŠ¨æ±½è½¦ä¿æœ‰é‡åŸºç¡€æ•°æ®</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="base_evs" class="input-field" value="1500" min="1000" max="3000" step="100">
                                <span class="input-unit">ä¸‡è¾†</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">å¹´å¤åˆå¢é•¿ç‡</label>
                            <div class="input-wrapper">
                                <input type="number" id="growth_rate" class="input-field" value="25" min="10" max="50" step="1">
                                <span class="input-unit">%</span>
                            </div>
                            <input type="range" id="growth_rate_slider" class="input-slider" min="10" max="50" value="25" step="1">
                        </div>

                        <div class="input-group">
                            <label class="input-label">å……ç”µæ¡©å¸‚åœºæ¸—é€ç‡</label>
                            <div class="input-wrapper">
                                <input type="number" id="penetration_rate" class="input-field" value="35" min="20" max="60" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    </div>

                    <!-- è¿è¥å‚æ•° -->
                    <div id="operation-tab" class="tab-content">
                        <div class="input-group">
                            <label class="input-label">å•ç«™å……ç”µæªæ•°é‡</label>
                            <div class="input-wrapper">
                                <input type="number" id="guns_per_station" class="input-field" value="12" min="6" max="24" step="2">
                                <span class="input-unit">æª</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">è®¾å¤‡åˆ©ç”¨ç‡</label>
                            <div class="input-wrapper">
                                <input type="number" id="utilization_rate" class="input-field" value="30" min="10" max="60" step="1">
                                <span class="input-unit">%</span>
                            </div>
                            <input type="range" id="utilization_rate_slider" class="input-slider" min="10" max="60" value="30" step="1">
                        </div>

                        <div class="input-group">
                            <label class="input-label">æ—¥è¿è¥å°æ—¶æ•°</label>
                            <div class="input-wrapper">
                                <input type="number" id="daily_hours" class="input-field" value="20" min="12" max="24" step="1">
                                <span class="input-unit">å°æ—¶</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">å•æªå¹³å‡åŠŸç‡</label>
                            <div class="input-wrapper">
                                <input type="number" id="gun_power" class="input-field" value="180" min="60" max="600" step="20">
                                <span class="input-unit">kW</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">å……ç”µæ”¶å…¥å•ä»·</label>
                            <div class="input-wrapper">
                                <input type="number" id="charging_price" class="input-field" value="0.95" min="0.5" max="2.0" step="0.05">
                                <span class="input-unit">å…ƒ/åº¦</span>
                            </div>
                            <input type="range" id="charging_price_slider" class="input-slider" min="0.5" max="2.0" value="0.95" step="0.05">
                        </div>
                    </div>

                    <!-- æˆæœ¬å‚æ•° -->
                    <div id="cost-tab" class="tab-content">
                        <div class="input-group">
                            <label class="input-label">æœåŠ¡è´¹ä»·å·®</label>
                            <div class="input-wrapper">
                                <input type="number" id="price_spread" class="input-field" value="0.55" min="0.3" max="1.0" step="0.05">
                                <span class="input-unit">å…ƒ/åº¦</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">ç”µè´¹æˆæœ¬</label>
                            <div class="input-wrapper">
                                <input type="number" id="electricity_cost" class="input-field" value="0.4" min="0.2" max="0.8" step="0.05">
                                <span class="input-unit">å…ƒ/åº¦</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">å•ç«™å¹´äººå·¥æˆæœ¬</label>
                            <div class="input-wrapper">
                                <input type="number" id="labor_cost" class="input-field" value="120" min="60" max="300" step="10">
                                <span class="input-unit">åƒå…ƒ</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">å•ç«™å¹´ç§Ÿé‡‘æˆæœ¬</label>
                            <div class="input-wrapper">
                                <input type="number" id="rent_cost" class="input-field" value="80" min="40" max="200" step="10">
                                <span class="input-unit">ä¸‡å…ƒ</span>
                            </div>
                        </div>
                    </div>

                    <!-- æŠ•äº§å‚æ•° -->
                    <div id="production-tab" class="tab-content">
                        <div class="input-group">
                            <label class="input-label">è®¡åˆ’å»ºè®¾å……ç”µç«™æ•°é‡</label>
                            <div class="input-wrapper">
                                <input type="number" id="total_stations" class="input-field" value="1000" min="100" max="2000" step="100">
                                <span class="input-unit">åº§</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">å•ç«™å»ºè®¾æˆæœ¬</label>
                            <div class="input-wrapper">
                                <input type="number" id="construction_cost" class="input-field" value="280" min="150" max="500" step="10">
                                <span class="input-unit">ä¸‡å…ƒ</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">æ”¿åºœè¡¥è´´æ¯”ä¾‹</label>
                            <div class="input-wrapper">
                                <input type="number" id="subsidy_rate" class="input-field" value="10" min="0" max="30" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">æŠ˜ç°ç‡</label>
                            <div class="input-wrapper">
                                <input type="number" id="discount_rate" class="input-field" value="12" min="8" max="20" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    </div>

                    <!-- å…¬å¸å†³ç­–å‚æ•° -->
                    <div id="decision-tab" class="tab-content">
                        <div class="input-group">
                            <label class="input-label">
                                èµ„æœ¬å…¬ç§¯è®¡ææ¯”ä¾‹
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">ä»å‡€åˆ©æ¶¦ä¸­è®¡æèµ„æœ¬å…¬ç§¯çš„æ¯”ä¾‹ï¼Œç”¨äºå…¬å¸å‘å±•å’Œé£é™©ç¼“å†²</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="capital_surplus_rate" class="input-field" value="20" min="0" max="50" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">
                                é¡¹ç›®ä¼ä¸šæ‰€å¾—ç¨ç‡
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">é¡¹ç›®å…¬å¸é€‚ç”¨çš„ä¼ä¸šæ‰€å¾—ç¨ç‡ï¼Œå½±å“ç¨ååˆ©æ¶¦è®¡ç®—</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="corporate_tax_rate" class="input-field" value="25" min="0" max="35" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">
                                å½’å±æŠ•èµ„è€…å¯åˆ†é…åˆ©æ¶¦
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">ç¨ååˆ©æ¶¦ä¸­åˆ†é…ç»™æŠ•èµ„è€…çš„æ¯”ä¾‹ï¼Œå½±å“æŠ•èµ„è€…åˆ†çº¢è®¡ç®—</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="distributable_profit_rate" class="input-field" value="70" min="0" max="70" step="1">
                                <span class="input-unit">%</span>
                            </div>
                            <input type="range" id="distributable_profit_rate_slider" class="input-slider" min="0" max="70" value="70" step="1">
                        </div>
                    </div>
                </div>

                <!-- é¡¹ç›®è®¡ç®—æŒ‰é’® -->
                <div class="calculation-buttons">
                    <button class="btn-primary project-calc-btn" onclick="calculateProjectResults()" id="project_calc_btn">
                        ğŸ“Š ç¬¬ä¸€æ­¥ï¼šè®¡ç®—é¡¹ç›®åˆ†æ
                    </button>
                    <button class="btn-primary investment-calc-btn" onclick="calculateInvestmentResults()" id="investment_calc_btn" disabled>
                        ğŸ’° ç¬¬äºŒæ­¥ï¼šè®¡ç®—æŠ•èµ„å›æŠ¥
                    </button>
                </div>
                <div class="calculation-status" id="calculation_status">
                    <span class="status-text">è¯·å…ˆå®Œæˆé¡¹ç›®åˆ†æè®¡ç®—</span>
                </div>

                <!-- åˆ†éš”çº¿ -->
                <div class="section-divider">
                    <div class="divider-line"></div>
                    <div class="divider-text">
                        <span class="divider-icon">ğŸ’°</span>
                        æŠ•èµ„è€…ä¸ªæ€§åŒ–å‚æ•°è®¾ç½®
                    </div>
                    <div class="divider-line"></div>
                </div>

                <!-- æŠ•èµ„å‚æ•°è®¾ç½®æ¨¡å— -->
                <div class="parameters-section">
                    <h3 class="section-title">
                        <span class="section-icon">ğŸ’µ</span>
                        æŠ•èµ„å‚æ•°è®¾ç½®
                        <span class="section-subtitle">å®šåˆ¶åŒ–æŠ•èµ„æ–¹æ¡ˆè®¾è®¡</span>
                    </h3>

                    <div class="section-tabs">
                        <button class="tab active" onclick="switchInvestmentTab('share')">ä»½é¢å‚æ•°</button>
                        <button class="tab" onclick="switchInvestmentTab('timing')">æŠ•å…¥æ—¶æœº</button>
                        <button class="tab" onclick="switchInvestmentTab('channel')">æŠ•èµ„æ¸ é“</button>
                    </div>

                    <!-- ä»½é¢å‚æ•° -->
                    <div id="share-tab" class="tab-content active">
                        <div class="input-group">
                            <label class="input-label">
                                æŠ•èµ„ä»½é¢å æ¯”
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">æ‚¨åœ¨é¡¹ç›®ä¸­çš„æŠ•èµ„ä»½é¢æ¯”ä¾‹</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="investment_share" class="input-field" value="100" min="10" max="100" step="5">
                                <span class="input-unit">%</span>
                            </div>
                            <input type="range" id="investment_share_slider" class="input-slider" min="10" max="100" value="100" step="5">
                        </div>

  
                        <div class="input-group">
                            <label class="input-label">
                                æŠ•èµ„è€…å…¬å¸ç»è¥ç¨ç‡
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">æŠ•èµ„è€…æ‰€åœ¨å…¬å¸çš„ç»è¥æ‰€å¾—ç¨ç¨ç‡ï¼ˆé»˜è®¤0%ï¼Œå› é¡¹ç›®å·²ç¼´ä¼ä¸šæ‰€å¾—ç¨ï¼‰</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="investor_corporate_tax_rate" class="input-field" value="0" min="0" max="30" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">
                                ä¸ªäººæ‰€å¾—ç¨ç‡
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">åˆ†çº¢ä¸ªäººæ‰€å¾—ç¨ç¨ç‡</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="personal_tax_rate" class="input-field" value="20" min="0" max="45" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    </div>

                    <!-- æŠ•å…¥æ—¶æœº -->
                    <div id="timing-tab" class="tab-content">
                        <div class="input-group">
                            <label class="input-label">æŠ•èµ„æ—¶æœºé€‰æ‹©</label>
                            <select id="investment_timing" class="input-field" onchange="updateTimingParameters()">
                                <option value="preparation">ç­¹å¤‡æœŸ - é¡¹ç›®å¯åŠ¨å‰</option>
                                <option value="production">æŠ•äº§æœŸ - å»ºè®¾è¿è¥ä¸­</option>
                                <option value="payback">å›æœ¬æœŸ - å¼€å§‹ç›ˆåˆ©ï¼ˆåŸºäºé¡¹ç›®è®¡ç®—ç»“æœï¼‰</option>
                                <option value="listing">ä¸Šå¸‚æœŸ - IPOå‰</option>
                                <option value="securitization">å¤šå…ƒè¯åˆ¸åŒ–æœŸ - æˆç†Ÿè¿è¥</option>
                            </select>
                        </div>

                        <div class="project-timing-info" id="project-timing-info" style="display: none;">
                            <div class="info-card">
                                <h4>é¡¹ç›®å…³é”®æ—¶ç‚¹ï¼ˆåŸºäºè®¡ç®—ç»“æœï¼‰</h4>
                                <div class="timing-data">
                                    <div class="timing-item">
                                        <span class="timing-label">é¡¹ç›®å›æ”¶æœŸï¼š</span>
                                        <span class="timing-value" id="project_payback_display">--</span>
                                    </div>
                                    <div class="timing-item">
                                        <span class="timing-label">é¡¹ç›®IRRï¼š</span>
                                        <span class="timing-value" id="project_irr_display">--</span>
                                    </div>
                                    <div class="timing-item">
                                        <span class="timing-label">é¡¹ç›®NPVï¼š</span>
                                        <span class="timing-value" id="project_npv_display">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="timing-parameters" id="timing-parameters">
                            <div class="input-group">
                                <label class="input-label">
                                    ç­¹å¤‡æœŸæŠ•èµ„æº¢ä»·
                                    <span class="tooltip">â„¹ï¸
                                        <span class="tooltiptext">æ—©æœŸæŠ•èµ„é£é™©æº¢ä»·ï¼Œé€šå¸¸ä¸ºè´Ÿå€¼ï¼ˆæŠ˜ä»·ï¼‰</span>
                                    </span>
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" id="preparation_premium" class="input-field" value="0" min="-50" max="0" step="1">
                                    <span class="input-unit">%</span>
                                </div>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">
                                æŠ•èµ„æ—¶ç‚¹
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">ç›¸å¯¹é¡¹ç›®å¯åŠ¨çš„æ—¶é—´ç‚¹ï¼Œå›æœ¬æœŸå°†åŸºäºé¡¹ç›®è®¡ç®—ç»“æœè‡ªåŠ¨è®¾ç½®</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="investment_year" class="input-field" value="0" min="0" max="10" step="1" readonly>
                                <span class="input-unit">å¹´</span>
                            </div>
                            <small class="timing-hint" id="timing_hint">è¯·å…ˆå®Œæˆé¡¹ç›®åˆ†æè®¡ç®—</small>
                        </div>
                    </div>

                    <!-- æŠ•èµ„æ¸ é“ -->
                    <div id="channel-tab" class="tab-content">
                        <div class="input-group">
                            <label class="input-label">æŠ•èµ„æ¸ é“é€‰æ‹©</label>
                            <select id="investment_channel" class="input-field" onchange="updateChannelParameters()">
                                <option value="self_funding">è‡ªæœ‰èµ„é‡‘ - ç›´æ¥æŠ•èµ„</option>
                                <option value="domestic_fund">å›½å†…è‚¡æƒåŸºé‡‘ - ä¸“ä¸šæŠ•èµ„</option>
                                <option value="foreign_fund">å›½å¤–åŸºé‡‘ - å›½é™…èµ„æœ¬</option>
                                <option value="strategic_investor">æˆ˜ç•¥æœºæ„ - äº§ä¸šååŒ</option>
                                <option value="partnership">åˆä¼™æœºæ„ - åˆä½œæŠ•èµ„</option>
                            </select>
                        </div>

                        <div class="channel-parameters" id="channel-parameters">
                            <div class="input-group">
                                <label class="input-label">
                                    åŸºé‡‘ç®¡ç†è´¹ç‡
                                    <span class="tooltip">â„¹ï¸
                                        <span class="tooltiptext">å¹´åº¦ç®¡ç†è´¹ï¼ŒæŒ‰æŠ•èµ„é¢è®¡ç®—</span>
                                    </span>
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" id="fund_management_fee" class="input-field" value="2" min="0" max="5" step="0.1">
                                    <span class="input-unit">%</span>
                                </div>
                            </div>

                            <div class="input-group">
                                <label class="input-label">
                                    ä¸šç»©åˆ†æˆæ¯”ä¾‹
                                    <span class="tooltip">â„¹ï¸
                                        <span class="tooltiptext">åŸºé‡‘æ”¶ç›Šåˆ†æˆæ¯”ä¾‹</span>
                                    </span>
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" id="fund_carried_interest" class="input-field" value="20" min="0" max="50" step="1">
                                    <span class="input-unit">%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç»“æœæ˜¾ç¤ºé¢æ¿ -->
            <div class="panel">
                <h2 class="panel-title">ğŸ“Š åˆ†æç»“æœ</h2>

                <!-- é¡¹ç›®åˆ†æç»“æœæ¨¡å— -->
                <div class="results-section">
                    <h3 class="section-title">
                        <span class="section-icon">ğŸ¢</span>
                        é¡¹ç›®åˆ†æç»“æœ
                        <span class="section-subtitle">é¡¹ç›®æ•´ä½“è´¢åŠ¡è¡¨ç°</span>
                    </h3>
                    <div class="results-grid">
                        <div class="result-card result-highlight">
                            <div class="result-value" id="irr_result">42.8%</div>
                            <div class="result-label">é¡¹ç›®IRR</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="npv_result">12.4äº¿</div>
                            <div class="result-label">é¡¹ç›®NPV</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="total_investment_result">28.0äº¿</div>
                            <div class="result-label">é¡¹ç›®æ€»æŠ•èµ„</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="payback_result">4.5å¹´</div>
                            <div class="result-label">é¡¹ç›®å›æŠ¥æœŸ</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="annual_revenue_result">52.6äº¿</div>
                            <div class="result-label">å¹´å‡è¥ä¸šæ”¶å…¥</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="annual_cost_result">--äº¿</div>
                            <div class="result-label">å¹´å‡è¥ä¸šæˆæœ¬</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="annual_distributable_profit_result">--äº¿</div>
                            <div class="result-label">å¹´å‡å¯åˆ†é…åˆ©æ¶¦</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="total_profit_result">121.9äº¿</div>
                            <div class="result-label">10å¹´é¡¹ç›®ç´¯è®¡åˆ©æ¶¦</div>
                        </div>
                    </div>
                </div>

                <!-- åˆ†éš”çº¿ -->
                <div class="section-divider">
                    <div class="divider-line"></div>
                    <div class="divider-text">
                        <span class="divider-icon">ğŸ’°</span>
                        åŸºäºæŠ•èµ„ä»½é¢å’Œåˆ†çº¢å‚æ•°è®¡ç®—
                    </div>
                    <div class="divider-line"></div>
                </div>

                <!-- æŠ•èµ„å›æŠ¥åˆ†ææ¨¡å— -->
                <div class="results-section" id="investment-results-section" style="display: none;">
                    <h3 class="section-title">
                        <span class="section-icon">ğŸ’µ</span>
                        æŠ•èµ„å›æŠ¥åˆ†æ
                        <span class="section-subtitle">æ‚¨çš„å®é™…æŠ•èµ„å›æŠ¥ï¼ˆåŸºäºé¡¹ç›®è®¡ç®—ç»“æœï¼‰</span>
                    </h3>
                    <div class="results-grid">
                        <div class="result-card result-highlight">
                            <div class="result-value" id="investor_irr_result">--%</div>
                            <div class="result-label">æŠ•èµ„è€…IRR</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="asset_present_value_result">--äº¿</div>
                            <div class="result-label">èµ„äº§ç°å€¼</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="actual_investment_result">--äº¿</div>
                            <div class="result-label">å®é™…æŠ•å…¥æˆæœ¬</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="investor_payback_result">--å¹´</div>
                            <div class="result-label">æŠ•èµ„å›æŠ¥æœŸ</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="after_tax_dividend_result">--äº¿</div>
                            <div class="result-label">å¹´å‡ç¨ååˆ†çº¢</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="total_investor_profit_result">--äº¿</div>
                            <div class="result-label">10å¹´æŠ•èµ„è€…ç´¯è®¡åˆ©æ¶¦</div>
                        </div>
                    </div>

                    </div>

                <div class="formula-display">
                    <strong>ğŸ“ è®¡ç®—å…¬å¼è¯´æ˜ï¼š</strong><br>
                    <strong>é¡¹ç›®å±‚é¢ï¼š</strong>IRR = ä½¿NPV=0çš„æŠ˜ç°ç‡ | NPV = Î£(CFt / (1+r)^t) - åˆå§‹æŠ•èµ„<br>
                    <strong>æŠ•èµ„è€…å±‚é¢ï¼š</strong>æŠ•èµ„è€…IRR = åŸºäºç¨ååˆ†çº¢è®¡ç®— | æŠ•èµ„å›æŠ¥ç‡ = ç´¯è®¡ç¨ååˆ†çº¢ / å®é™…æŠ•èµ„é¢<br>
                    <strong>åˆ†çº¢è®¡ç®—ï¼š</strong>ç¨ååˆ†çº¢ = é¡¹ç›®å‡€åˆ©æ¶¦ Ã— æŠ•èµ„ä»½é¢ Ã— (1 - ä¸ªäººæ‰€å¾—ç¨ç‡)
                </div>
            </div>
        </div>

        <!-- ç°é‡‘æµå›¾è¡¨ -->
        <div class="chart-container">
            <h3 class="chart-title">ğŸ’° 10å¹´é¡¹ç›®ç»è¥ç°é‡‘æµé¢„æµ‹</h3>
            <div class="chart-description">
                <p><strong>æ•°æ®è¯´æ˜ï¼š</strong>å›¾è¡¨æ˜¾ç¤ºçš„æ˜¯<strong>é¡¹ç›®ç»è¥ç°é‡‘æµ</strong>ï¼ˆç¨åå‡€åˆ©æ¶¦ + æŠ˜æ—§è´¹ç”¨ï¼‰ï¼Œä¸æ˜¯æŠ•èµ„è€…ä¸ªäººåˆ†çº¢æ”¶å…¥ã€‚</p>
                <p><strong>ç”¨é€”ï¼š</strong>ç”¨äºè®¡ç®—é¡¹ç›®æ•´ä½“IRRå’ŒNPVï¼Œåæ˜ é¡¹ç›®ç»è¥äº§ç”Ÿçš„å®é™…ç°é‡‘æµå…¥ã€‚</p>
            </div>
            <div class="simple-chart">
                <div class="bar-container" id="cashflow_chart">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„æŸ±çŠ¶å›¾ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // å‚æ•°é»˜è®¤å€¼
        const defaultParameters = {
            base_evs: 1500,
            growth_rate: 25,
            penetration_rate: 35,
            guns_per_station: 12,
            utilization_rate: 30,
            daily_hours: 20,
            gun_power: 180,
            charging_price: 0.95,
            price_spread: 0.55,
            electricity_cost: 0.4,
            labor_cost: 120,
            rent_cost: 80,
            total_stations: 1000,
            construction_cost: 280,
            subsidy_rate: 10,
            discount_rate: 12,
            investment_share: 100,
            corporate_tax_rate: 25,
            personal_tax_rate: 20,
            capital_surplus_rate: 20,
            distributable_profit_rate: 70,
            investor_corporate_tax_rate: 0
        };

        // æƒ…æ™¯å‚æ•° - åŒ…å«æ³¢åŠ¨èŒƒå›´ï¼ˆç¼©çª„èŒƒå›´ä»¥æä¾›æ›´ç°å®çš„é¢„æµ‹ï¼‰
        const scenarios = {
            conservative: {
                utilization_rate: 25,
                charging_price: 0.85,
                price_spread: 0.50,
                total_stations: 900,
                construction_cost: 300,
                volatility: {
                    revenue: [-0.08, 0.03],  // æ”¶å…¥æ³¢åŠ¨èŒƒå›´ï¼š-8%åˆ°+3%
                    cost: [0.03, 0.08],     // æˆæœ¬æ³¢åŠ¨èŒƒå›´ï¼š+3%åˆ°+8%
                    utilization: [-0.06, 0.02] // åˆ©ç”¨ç‡æ³¢åŠ¨ï¼š-6%åˆ°+2%
                }
            },
            base: {
                ...defaultParameters,
                volatility: {
                    revenue: [-0.05, 0.08],  // æ”¶å…¥æ³¢åŠ¨èŒƒå›´ï¼š-5%åˆ°+8%
                    cost: [0.02, 0.07],     // æˆæœ¬æ³¢åŠ¨èŒƒå›´ï¼š+2%åˆ°+7%
                    utilization: [-0.03, 0.05] // åˆ©ç”¨ç‡æ³¢åŠ¨ï¼š-3%åˆ°+5%
                }
            },
            optimistic: {
                utilization_rate: 35,
                charging_price: 1.05,
                price_spread: 0.58,
                total_stations: 1100,
                construction_cost: 265,
                volatility: {
                    revenue: [0.02, 0.12],   // æ”¶å…¥æ³¢åŠ¨èŒƒå›´ï¼š+2%åˆ°+12%
                    cost: [-0.01, 0.05],    // æˆæœ¬æ³¢åŠ¨èŒƒå›´ï¼š-1%åˆ°+5%
                    utilization: [0.01, 0.08]  // åˆ©ç”¨ç‡æ³¢åŠ¨ï¼š+1%åˆ°+8%
                }
            }
        };

        // éªŒè¯è®¡ç®—é€»è¾‘çš„æµ‹è¯•å‡½æ•°
        function validateCalculationLogic() {
            console.log('ğŸ” éªŒè¯è®¡ç®—é€»è¾‘...');

            // æµ‹è¯•æ¡ˆä¾‹ï¼šæŠ•èµ„ä»½é¢40%
            const testParams = {
                investment_share: 0.4,
                total_investment: 1000000000, // 10äº¿
                yearly_profits: [100000000, 150000000, 200000000, 250000000, 300000000], // å‰5å¹´åˆ©æ¶¦
                corporate_tax_rate: 0.25,
                personal_tax_rate: 0.20
            };

            // è®¡ç®—é¡¹ç›®ç°é‡‘æµï¼ˆç¨åå‡€åˆ©æ¶¦ï¼‰
            const project_cashflows = testParams.yearly_profits.map(profit =>
                profit * (1 - testParams.corporate_tax_rate)
            );

            // è®¡ç®—æŠ•èµ„è€…ç°é‡‘æµï¼ˆç¨ååˆ†çº¢ï¼‰
            const investor_cashflows = project_cashflows.map(profit =>
                profit * testParams.investment_share * (1 - testParams.personal_tax_rate)
            );

            // è®¡ç®—å›æ”¶æœŸ
            let project_payback = 0;
            let project_cumulative = -testParams.total_investment;

            let investor_payback = 0;
            let investor_cumulative = -testParams.total_investment * testParams.investment_share;

            for (let year = 0; year < project_cashflows.length; year++) {
                project_cumulative += project_cashflows[year];
                if (project_cumulative >= 0 && project_payback === 0) {
                    project_payback = year + 1;
                }

                investor_cumulative += investor_cashflows[year];
                if (investor_cumulative >= 0 && investor_payback === 0) {
                    investor_payback = year + 1;
                }
            }

            console.log('ğŸ“Š éªŒè¯ç»“æœï¼š');
            console.log(`æŠ•èµ„ä»½é¢ï¼š${testParams.investment_share * 100}%`);
            console.log(`é¡¹ç›®å›æ”¶æœŸï¼š${project_payback}å¹´`);
            console.log(`æŠ•èµ„è€…å›æ”¶æœŸï¼š${investor_payback}å¹´`);
            console.log(`âœ… éªŒè¯é€šè¿‡ï¼šæŠ•èµ„è€…å›æ”¶æœŸåº”è¯¥ >= é¡¹ç›®å›æ”¶æœŸ`);

            return investor_payback >= project_payback;
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeInputs();

            // åˆå§‹åŒ–æŠ•èµ„å‚æ•°
            updateTimingParameters();
            updateChannelParameters();

            // éšè—æŠ•èµ„ç»“æœåŒºåŸŸ
            document.getElementById('investment-results-section').style.display = 'none';

            // è¿è¡ŒéªŒè¯æµ‹è¯•
            const isValid = validateCalculationLogic();
            if (!isValid) {
                console.error('âŒ è®¡ç®—é€»è¾‘éªŒè¯å¤±è´¥ï¼');
            }
        });

        // åˆå§‹åŒ–è¾“å…¥æ§ä»¶
        function initializeInputs() {
            // ç»‘å®šæ»‘å—äº‹ä»¶
            const sliders = [
                {slider: 'growth_rate_slider', input: 'growth_rate'},
                {slider: 'utilization_rate_slider', input: 'utilization_rate'},
                {slider: 'charging_price_slider', input: 'charging_price'},
                {slider: 'distributable_profit_rate_slider', input: 'distributable_profit_rate'},
                {slider: 'investment_share_slider', input: 'investment_share'}
            ];

            sliders.forEach(({slider, input}) => {
                const sliderEl = document.getElementById(slider);
                const inputEl = document.getElementById(input);

                if (sliderEl && inputEl) {
                    sliderEl.addEventListener('input', function() {
                        inputEl.value = this.value;
                    });

                    inputEl.addEventListener('input', function() {
                        sliderEl.value = this.value;
                    });
                }
            });

            // ä¸ºæŠ•èµ„å‚æ•°æ·»åŠ è‡ªåŠ¨é‡æ–°è®¡ç®—åŠŸèƒ½
            const investmentInputs = [
                'investment_share', 'investment_timing',
                'investment_channel', 'fund_management_fee', 'fund_carried_interest',
                'investor_corporate_tax_rate', 'personal_tax_rate'
            ];

            investmentInputs.forEach(inputId => {
                const element = document.getElementById(inputId);
                console.log(`ç»‘å®šäº‹ä»¶ç›‘å¬å™¨åˆ°: ${inputId}, å…ƒç´ :`, element);
                if (element) {
                    // ç›‘å¬å¤šç§äº‹ä»¶ä»¥ç¡®ä¿å‚æ•°å˜åŒ–è¢«æ•è·
                    const handleInputChange = function() {
                        console.log(`å‚æ•°å˜åŒ–æ£€æµ‹åˆ°: ${inputId} = ${this.value}`);
                        // å¦‚æœé¡¹ç›®è®¡ç®—å·²å®Œæˆï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—æŠ•èµ„ç»“æœ
                        if (projectCalculationResults) {
                            console.log('è§¦å‘æŠ•èµ„å›æŠ¥åˆ†æé‡æ–°è®¡ç®—');
                            calculateInvestmentResults();
                        } else {
                            console.log('é¡¹ç›®è®¡ç®—ç»“æœä¸å­˜åœ¨ï¼Œæ— æ³•é‡æ–°è®¡ç®—æŠ•èµ„å›æŠ¥');
                        }
                    };

                    element.addEventListener('input', handleInputChange);
                    element.addEventListener('change', handleInputChange);
                } else {
                    console.error(`æ‰¾ä¸åˆ°å…ƒç´ : ${inputId}`);
                }
            });
        }

        // åˆ‡æ¢é¡¹ç›®å‚æ•°æ ‡ç­¾é¡µ
        function switchProjectTab(tabName) {
            // éšè—æ‰€æœ‰é¡¹ç›®æ ‡ç­¾å†…å®¹
            document.querySelectorAll('#market-tab, #operation-tab, #cost-tab, #production-tab, #decision-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰é¡¹ç›®æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.parameters-section:first-child .tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName + '-tab').classList.add('active');

            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾
            event.target.classList.add('active');
        }

        // åˆ‡æ¢æŠ•èµ„å‚æ•°æ ‡ç­¾é¡µ
        function switchInvestmentTab(tabName) {
            // éšè—æ‰€æœ‰æŠ•èµ„æ ‡ç­¾å†…å®¹
            document.querySelectorAll('#share-tab, #timing-tab, #channel-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æŠ•èµ„æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.parameters-section:last-child .tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName + '-tab').classList.add('active');

            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾
            event.target.classList.add('active');
        }

        // æ›´æ–°æŠ•å…¥æ—¶æœºå‚æ•°
        function updateTimingParameters() {
            const timing = document.getElementById('investment_timing').value;
            const timingParams = document.getElementById('timing-parameters');

            let html = '';
            switch(timing) {
                case 'preparation':
                    html = `
                        <div class="input-group">
                            <label class="input-label">
                                ç­¹å¤‡æœŸæŠ•èµ„æº¢ä»·
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">æ—©æœŸæŠ•èµ„é£é™©æº¢ä»·ï¼Œé€šå¸¸ä¸ºè´Ÿå€¼ï¼ˆæŠ˜ä»·ï¼‰</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="preparation_premium" class="input-field" value="0" min="-50" max="0" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'production':
                    html = `
                        <div class="input-group">
                            <label class="input-label">
                                æŠ•äº§æœŸæŠ•èµ„æº¢ä»·
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">å»ºè®¾æœŸæŠ•èµ„æº¢ä»·ï¼Œé€šå¸¸æœ‰å°å¹…æº¢ä»·</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="production_premium" class="input-field" value="15" min="-10" max="20" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'payback':
                    html = `
                        <div class="input-group">
                            <label class="input-label">
                                å›æœ¬æœŸæŠ•èµ„æº¢ä»·
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">å¼€å§‹ç›ˆåˆ©æœŸçš„æŠ•èµ„æº¢ä»·</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="payback_premium" class="input-field" value="45" min="0" max="50" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'listing':
                    html = `
                        <div class="input-group">
                            <label class="input-label">
                                ä¸Šå¸‚æœŸæŠ•èµ„æº¢ä»·
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">IPOå‰æŠ•èµ„æº¢ä»·ï¼Œè¾ƒé«˜æº¢ä»·</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="listing_premium" class="input-field" value="60" min="20" max="100" step="5">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'securitization':
                    html = `
                        <div class="input-group">
                            <label class="input-label">
                                è¯åˆ¸åŒ–æœŸæŠ•èµ„æº¢ä»·
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">æˆç†ŸæœŸæŠ•èµ„æº¢ä»·ï¼Œç¨³å®šæº¢ä»·</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="securitization_premium" class="input-field" value="80" min="50" max="150" step="5">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    `;
                    break;
            }

            timingParams.innerHTML = html;
        }

        // æ›´æ–°æŠ•èµ„æ¸ é“å‚æ•°
        function updateChannelParameters() {
            const channel = document.getElementById('investment_channel').value;
            const channelParams = document.getElementById('channel-parameters');

            let html = '';
            switch(channel) {
                case 'self_funding':
                    html = `
                        <div class="input-group">
                            <label class="input-label">
                                èµ„é‡‘æˆæœ¬è°ƒæ•´
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">è‡ªæœ‰èµ„é‡‘çš„æœºä¼šæˆæœ¬è°ƒæ•´</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="self_funding_cost" class="input-field" value="0" min="0" max="2" step="0.1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'domestic_fund':
                    html = `
                        <div class="input-group">
                            <label class="input-label">
                                åŸºé‡‘ç®¡ç†è´¹ç‡
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">å¹´åº¦ç®¡ç†è´¹ï¼ŒæŒ‰æŠ•èµ„é¢è®¡ç®—</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="domestic_management_fee" class="input-field" value="2" min="0" max="5" step="0.1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">
                                ä¸šç»©åˆ†æˆæ¯”ä¾‹
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">åŸºé‡‘æ”¶ç›Šåˆ†æˆæ¯”ä¾‹</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="domestic_carried_interest" class="input-field" value="20" min="0" max="50" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'foreign_fund':
                    html = `
                        <div class="input-group">
                            <label class="input-label">
                                åŸºé‡‘ç®¡ç†è´¹ç‡
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">å›½å¤–åŸºé‡‘ç®¡ç†è´¹ç‡é€šå¸¸æ›´é«˜</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="foreign_management_fee" class="input-field" value="2.5" min="0" max="6" step="0.1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">
                                ä¸šç»©åˆ†æˆæ¯”ä¾‹
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">å›½å¤–åŸºé‡‘æ”¶ç›Šåˆ†æˆæ¯”ä¾‹</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="foreign_carried_interest" class="input-field" value="25" min="0" max="50" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">
                                æ±‡ç‡é£é™©æº¢ä»·
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">å›½å¤–æŠ•èµ„çš„æ±‡ç‡é£é™©è¡¥å¿</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="foreign_exchange_risk" class="input-field" value="3" min="0" max="10" step="0.5">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'strategic_investor':
                    html = `
                        <div class="input-group">
                            <label class="input-label">
                                æˆ˜ç•¥ååŒä»·å€¼
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">æˆ˜ç•¥æŠ•èµ„å¸¦æ¥çš„ååŒæ•ˆåº”ä»·å€¼</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="strategic_synergy_value" class="input-field" value="10" min="0" max="30" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">
                                ç®¡ç†å‚ä¸æˆæœ¬
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">æˆ˜ç•¥æŠ•èµ„è€…å‚ä¸ç®¡ç†çš„æˆæœ¬</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="strategic_management_cost" class="input-field" value="1" min="0" max="3" step="0.1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    `;
                    break;
                case 'partnership':
                    html = `
                        <div class="input-group">
                            <label class="input-label">
                                åˆä¼™ç®¡ç†è´¹
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">åˆä¼™æœºæ„çš„ç®¡ç†è´¹ç”¨</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="partnership_management_fee" class="input-field" value="1.5" min="0" max="4" step="0.1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">
                                åˆä¼™åˆ†æˆæ¯”ä¾‹
                                <span class="tooltip">â„¹ï¸
                                    <span class="tooltiptext">åˆä¼™æœºæ„çš„æ”¶ç›Šåˆ†æˆ</span>
                                </span>
                            </label>
                            <div class="input-wrapper">
                                <input type="number" id="partnership_carried_interest" class="input-field" value="15" min="0" max="40" step="1">
                                <span class="input-unit">%</span>
                            </div>
                        </div>
                    `;
                    break;
            }

            channelParams.innerHTML = html;
        }

        // åŠ è½½æƒ…æ™¯å‚æ•°
        function loadScenario(scenarioName) {
            const scenario = scenarios[scenarioName];

            Object.keys(scenario).forEach(key => {
                const input = document.getElementById(key);
                if (input) {
                    input.value = scenario[key];

                    // åŒæ­¥æ»‘å—
                    const slider = document.getElementById(key + '_slider');
                    if (slider) {
                        slider.value = scenario[key];
                    }
                }
            });

            calculateResults();
        }

        // é‡ç½®å‚æ•°
        function resetParameters() {
            loadScenario('base');
        }

        // è·å–æŠ•èµ„æ—¶æœºæº¢ä»·
        function getTimingPremium() {
            const timing = document.getElementById('investment_timing').value;
            let premium = 0;

            switch(timing) {
                case 'preparation':
                    premium = parseFloat(document.getElementById('preparation_premium')?.value || 0);
                    break;
                case 'production':
                    premium = parseFloat(document.getElementById('production_premium')?.value || 0);
                    break;
                case 'payback':
                    premium = parseFloat(document.getElementById('payback_premium')?.value || 0);
                    break;
                case 'listing':
                    premium = parseFloat(document.getElementById('listing_premium')?.value || 0);
                    break;
                case 'securitization':
                    premium = parseFloat(document.getElementById('securitization_premium')?.value || 0);
                    break;
            }

            return premium / 100;
        }

        // å…¨å±€å˜é‡å­˜å‚¨é¡¹ç›®è®¡ç®—ç»“æœ
        let projectCalculationResults = null;

        // ç¬¬ä¸€æ­¥ï¼šè®¡ç®—é¡¹ç›®åˆ†æç»“æœ
        function calculateProjectResults() {
            const params = getParameters();
            // åªè·å–é¡¹ç›®ç›¸å…³å‚æ•°ï¼Œå¿½ç•¥æŠ•èµ„å‚æ•°
            const projectParams = getProjectParameters(params);

            projectCalculationResults = performProjectCalculations(projectParams);
            displayProjectResults(projectCalculationResults);
            updateCashflowChart(projectCalculationResults.project_cashflows);

            // æ›´æ–°UIçŠ¶æ€
            updateProjectCalculationUI(projectCalculationResults);
            enableInvestmentCalculation();
        }

        // ç¬¬äºŒæ­¥ï¼šè®¡ç®—æŠ•èµ„å›æŠ¥ç»“æœ
        function calculateInvestmentResults() {
            console.log('=== å¼€å§‹è®¡ç®—æŠ•èµ„å›æŠ¥åˆ†æ ===');
            if (!projectCalculationResults) {
                alert('è¯·å…ˆå®Œæˆé¡¹ç›®åˆ†æè®¡ç®—');
                return;
            }

            // åº”ç”¨å½“å‰é€‰æ‹©çš„æŠ•èµ„æ—¶ç‚¹è®¾ç½®åˆ°å®é™…å‚æ•°ä¸­
            applyInvestmentTimingToParameters(projectCalculationResults);

            const params = getParameters();
            console.log('æŠ•èµ„è®¡ç®—å‚æ•°:', {
                personal_tax_rate: params.personal_tax_rate,
                investor_corporate_tax_rate: params.investor_corporate_tax_rate,
                investment_share: params.investment_share
            });

            // åŸºäºé¡¹ç›®ç»“æœè¿›è¡ŒæŠ•èµ„è®¡ç®—
            const investmentResults = performInvestmentCalculations(params, projectCalculationResults);
            console.log('æŠ•èµ„è®¡ç®—ç»“æœ:', investmentResults);
            displayInvestmentResults(investmentResults);

            // æ›´æ–°UIçŠ¶æ€
            updateInvestmentCalculationUI(investmentResults);
        }

        // å°†æŠ•èµ„æ—¶ç‚¹è®¾ç½®åº”ç”¨åˆ°å®é™…è®¡ç®—å‚æ•°
        function applyInvestmentTimingToParameters(projectResults) {
            const timingType = document.getElementById('investment_timing').value;
            let investmentYear = 1;

            switch(timingType) {
                case 'preparation':
                    investmentYear = 1; // ç­¹å¤‡æœŸï¼šç¬¬1å¹´
                    break;
                case 'production':
                    investmentYear = 2; // æŠ•äº§æœŸï¼šç¬¬2å¹´
                    break;
                case 'payback':
                    investmentYear = projectResults.payback_period; // å›æŠ¥æœŸï¼šé¡¹ç›®è®¡ç®—å›æ”¶æœŸ
                    break;
                case 'listing':
                    investmentYear = projectResults.payback_period + 2; // IPOï¼šå›æŠ¥æœŸå2å¹´
                    break;
                case 'securitization':
                    investmentYear = projectResults.payback_period + 5; // è¯åˆ¸åŒ–ï¼šå›æŠ¥æœŸå5å¹´
                    break;
                default:
                    investmentYear = 1;
            }

            // å®é™…æ›´æ–°æŠ•èµ„å¹´ä»½è¾“å…¥æ¡†ï¼ˆç”¨äºè®¡ç®—ï¼‰
            document.getElementById('investment_year').value = investmentYear.toFixed(1);

            // æ›´æ–°æç¤ºä¿¡æ¯
            const hintElement = document.getElementById('timing_hint');
            if (hintElement) {
                hintElement.textContent = `å·²åº”ç”¨æŠ•èµ„æ—¶ç‚¹ï¼šç¬¬${investmentYear.toFixed(1)}å¹´`;
            }

            console.log(`æŠ•èµ„æ—¶ç‚¹å·²åº”ç”¨åˆ°è®¡ç®—: ${timingType} -> ç¬¬${investmentYear.toFixed(1)}å¹´`);
        }

        // è·å–é¡¹ç›®ç›¸å…³å‚æ•°
        function getProjectParameters(allParams) {
            return {
                base_evs: allParams.base_evs,
                growth_rate: allParams.growth_rate,
                penetration_rate: allParams.penetration_rate,
                guns_per_station: allParams.guns_per_station,
                utilization_rate: allParams.utilization_rate,
                daily_hours: allParams.daily_hours,
                gun_power: allParams.gun_power,
                charging_price: allParams.charging_price,
                price_spread: allParams.price_spread,
                electricity_cost: allParams.electricity_cost,
                labor_cost: allParams.labor_cost,
                rent_cost: allParams.rent_cost,
                total_stations: allParams.total_stations,
                construction_cost: allParams.construction_cost,
                subsidy_rate: allParams.subsidy_rate,
                discount_rate: allParams.discount_rate,
                corporate_tax_rate: allParams.corporate_tax_rate,
                personal_tax_rate: allParams.personal_tax_rate,
                capital_surplus_rate: allParams.capital_surplus_rate,
                distributable_profit_rate: allParams.distributable_profit_rate,
                investor_corporate_tax_rate: allParams.investor_corporate_tax_rate,
                // æ·»åŠ æŠ•èµ„ç›¸å…³å‚æ•°ï¼Œå› ä¸ºé¡¹ç›®è®¡ç®—é˜¶æ®µéœ€è¦è®¡ç®—æŠ•èµ„è€…ç°é‡‘æµ
                investment_share: allParams.investment_share,
                investment_timing: allParams.investment_timing,
                investment_year: allParams.investment_year,
                timing_premium: allParams.timing_premium,
                investment_channel: allParams.investment_channel
            };
        }

        // è·å–å‚æ•°å€¼
        function getParameters() {
            // è·å–åŸºç¡€å‚æ•°
            const baseParams = {
                base_evs: parseFloat(document.getElementById('base_evs').value),
                growth_rate: parseFloat(document.getElementById('growth_rate').value),
                penetration_rate: parseFloat(document.getElementById('penetration_rate').value),
                guns_per_station: parseInt(document.getElementById('guns_per_station').value),
                utilization_rate: parseFloat(document.getElementById('utilization_rate').value) / 100,
                daily_hours: parseFloat(document.getElementById('daily_hours').value),
                gun_power: parseFloat(document.getElementById('gun_power').value),
                charging_price: parseFloat(document.getElementById('charging_price').value),
                price_spread: parseFloat(document.getElementById('price_spread').value),
                electricity_cost: parseFloat(document.getElementById('electricity_cost').value),
                labor_cost: parseFloat(document.getElementById('labor_cost').value) * 10000,
                rent_cost: parseFloat(document.getElementById('rent_cost').value) * 10000,
                total_stations: parseInt(document.getElementById('total_stations').value),
                construction_cost: parseFloat(document.getElementById('construction_cost').value) * 10000,
                subsidy_rate: parseFloat(document.getElementById('subsidy_rate').value) / 100,
                discount_rate: parseFloat(document.getElementById('discount_rate').value) / 100,
                corporate_tax_rate: parseFloat(document.getElementById('corporate_tax_rate').value) / 100,
                personal_tax_rate: parseFloat(document.getElementById('personal_tax_rate').value) / 100,
                capital_surplus_rate: parseFloat(document.getElementById('capital_surplus_rate').value) / 100,
                distributable_profit_rate: parseFloat(document.getElementById('distributable_profit_rate').value) / 100,
                investor_corporate_tax_rate: parseFloat(document.getElementById('investor_corporate_tax_rate').value) / 100
            };

            // è·å–æŠ•èµ„å‚æ•°
            const investmentParams = {
                investment_share: parseFloat(document.getElementById('investment_share').value) / 100,
                investment_timing: document.getElementById('investment_timing').value,
                investment_channel: document.getElementById('investment_channel').value,
                investment_year: parseFloat(document.getElementById('investment_year').value),
                timing_premium: getTimingPremium()
            };

            // è·å–æ¸ é“ç›¸å…³å‚æ•°
            const channelParams = getChannelParameters(investmentParams.investment_channel);

            return { ...baseParams, ...investmentParams, ...channelParams };
        }

        // è·å–æ¸ é“ç›¸å…³å‚æ•°
        function getChannelParameters(channel) {
            const params = {};

            switch(channel) {
                case 'self_funding':
                    params.fund_management_fee = parseFloat(document.getElementById('self_funding_cost').value) / 100;
                    params.fund_carried_interest = 0;
                    break;
                case 'domestic_fund':
                    params.fund_management_fee = parseFloat(document.getElementById('domestic_management_fee').value) / 100;
                    params.fund_carried_interest = parseFloat(document.getElementById('domestic_carried_interest').value) / 100;
                    break;
                case 'foreign_fund':
                    params.fund_management_fee = parseFloat(document.getElementById('foreign_management_fee').value) / 100;
                    params.fund_carried_interest = parseFloat(document.getElementById('foreign_carried_interest').value) / 100;
                    params.exchange_risk_premium = parseFloat(document.getElementById('foreign_exchange_risk').value) / 100;
                    break;
                case 'strategic_investor':
                    params.strategic_synergy = parseFloat(document.getElementById('strategic_synergy_value').value) / 100;
                    params.management_cost = parseFloat(document.getElementById('strategic_management_cost').value) / 100;
                    params.fund_management_fee = params.management_cost;
                    params.fund_carried_interest = 0;
                    break;
                case 'partnership':
                    params.fund_management_fee = parseFloat(document.getElementById('partnership_management_fee').value) / 100;
                    params.fund_carried_interest = parseFloat(document.getElementById('partnership_carried_interest').value) / 100;
                    break;
            }

            return params;
        }

        // è¾…åŠ©è®¡ç®—å‡½æ•° - åœ¨performCalculationsä¹‹å‰å®šä¹‰
        // è®¡ç®—è€ƒè™‘æ—¶æœºçš„èµ„äº§ç°å€¼
        function calculateAssetPresentValue(total_investment, investment_year, discount_rate) {
            // ç®€åŒ–è®¡ç®—ï¼šå‡è®¾èµ„äº§ä»·å€¼æŒ‰æŠ•èµ„å¹´ä»½æŠ˜ç°
            return total_investment / Math.pow(1 + discount_rate, investment_year);
        }

        // è®¡ç®—æ¸ é“è´¹ç”¨
        function calculateChannelCosts(actual_investment, params) {
            const costs = {
                total_annual_costs: 0,
                management_costs: [],
                carried_interests: []
            };

            // ç®¡ç†è´¹ï¼ˆé€šå¸¸æŒ‰æŠ•èµ„é¢çš„å¹´è´¹ç‡è®¡ç®—ï¼‰
            if (params.fund_management_fee) {
                const annual_management_fee = actual_investment * params.fund_management_fee;
                costs.total_annual_costs += annual_management_fee;
                costs.management_costs.push(annual_management_fee);
            }

            // æˆ˜ç•¥ååŒä»·å€¼ï¼ˆå¦‚æœæ˜¯æˆ˜ç•¥æŠ•èµ„ï¼Œåˆ™ä¸ºæ­£æ•ˆç›Šï¼‰
            if (params.strategic_synergy) {
                const strategic_benefit = actual_investment * params.strategic_synergy;
                costs.total_annual_costs -= strategic_benefit; // è´Ÿå€¼è¡¨ç¤ºæ”¶ç›Š
            }

            return costs;
        }

        // è®¡ç®—è°ƒæ•´åçš„æŠ•èµ„è€…ç°é‡‘æµï¼ˆè€ƒè™‘æ¸ é“åˆ†æˆï¼‰
        function calculateAdjustedInvestorCashflows(investor_cashflows, params) {
            console.log('è®¡ç®—è°ƒæ•´åæŠ•èµ„è€…ç°é‡‘æµ - è¾“å…¥:', investor_cashflows, 'å‚æ•°:', params);

            const adjusted_cashflows = [];

            // å®‰å…¨æ£€æŸ¥
            const investment_share = params.investment_share || 0.01; // é˜²æ­¢é™¤é›¶
            const personal_tax_rate = params.personal_tax_rate;
            const investor_corporate_tax_rate = params.investor_corporate_tax_rate;
            const fund_management_fee = params.fund_management_fee || 0;
            const fund_carried_interest = params.fund_carried_interest || 0;

            console.log('è¯¦ç»†å‚æ•°æ£€æŸ¥:', {
                investment_share: investment_share,
                personal_tax_rate: personal_tax_rate,
                investor_corporate_tax_rate: investor_corporate_tax_rate,
                fund_management_fee: fund_management_fee,
                fund_carried_interest: fund_carried_interest
            });

            for (let i = 0; i < investor_cashflows.length; i++) {
                let adjusted_cashflow = investor_cashflows[i];
                console.log(`ç¬¬${i+1}å¹´åŸå§‹ç°é‡‘æµ: ${adjusted_cashflow}`);

                // éªŒè¯åŸå§‹ç°é‡‘æµ
                if (isNaN(adjusted_cashflow) || adjusted_cashflow < 0) {
                    console.error(`ç¬¬${i+1}å¹´ç°é‡‘æµå¼‚å¸¸: ${adjusted_cashflow}`);
                    adjusted_cashflow = 0;
                }

                // æŠ•èµ„è€…å…¬å¸æ‰€å¾—ç¨
                if (investor_corporate_tax_rate > 0) {
                    const investor_corporate_tax = adjusted_cashflow * investor_corporate_tax_rate;
                    adjusted_cashflow -= investor_corporate_tax;
                    console.log(`ç¬¬${i+1}å¹´æŠ•èµ„è€…å…¬å¸æ‰€å¾—ç¨: ${investor_corporate_tax}, ç¨å: ${adjusted_cashflow}`);
                }

                // ä¸ªäººæ‰€å¾—ç¨
                if (personal_tax_rate > 0) {
                    const personal_tax = adjusted_cashflow * personal_tax_rate;
                    adjusted_cashflow -= personal_tax;
                    console.log(`ç¬¬${i+1}å¹´ä¸ªäººæ‰€å¾—ç¨: ${personal_tax}, æœ€ç»ˆåˆ°æ‰‹: ${adjusted_cashflow}`);
                }

                // ç®€åŒ–ç®¡ç†è´¹è®¡ç®—ï¼šç›´æ¥ä»ç¨ååˆ†çº¢ä¸­æ‰£é™¤
                if (fund_management_fee > 0 && i < 10) { // å‰10å¹´æ”¶å–ç®¡ç†è´¹
                    const management_fee = adjusted_cashflow * fund_management_fee;
                    adjusted_cashflow -= management_fee;
                    console.log(`ç¬¬${i+1}å¹´ç®¡ç†è´¹: ${management_fee}, è°ƒæ•´åç°é‡‘æµ: ${adjusted_cashflow}`);
                }

                // ç®€åŒ–ä¸šç»©åˆ†æˆï¼šå¦‚æœæ”¶ç›Šç‡è¶…è¿‡15%ï¼Œåˆ™è¶…é¢éƒ¨åˆ†æ”¶å–åˆ†æˆ
                if (fund_carried_interest > 0 && i >= 4 && adjusted_cashflow > 0) { // ä»ç¬¬4å¹´å¼€å§‹æ”¶å–ä¸šç»©åˆ†æˆ
                    const expected_return = 0.15; // æœŸæœ›å¹´åŒ–æ”¶ç›Šç‡15%

                    // é¿å…å¤æ‚çš„æŠ•èµ„æœ¬é‡‘ä¼°ç®—ï¼Œç›´æ¥æŒ‰å›ºå®šåŸºå‡†è®¡ç®—
                    const benchmark_cashflow = 100000000; // 1äº¿ä½œä¸ºåŸºå‡†
                    const expected_cashflow = benchmark_cashflow * expected_return * investment_share;

                    if (adjusted_cashflow > expected_cashflow) {
                        const excess_return = adjusted_cashflow - expected_cashflow;
                        const carried_interest = excess_return * fund_carried_interest;
                        adjusted_cashflow -= carried_interest;
                        console.log(`ç¬¬${i+1}å¹´ä¸šç»©åˆ†æˆ: ${carried_interest}, è°ƒæ•´åç°é‡‘æµ: ${adjusted_cashflow}`);
                    }
                }

                // ç¡®ä¿å€¼ä¸æ˜¯è´Ÿæ•°æˆ–NaN
                adjusted_cashflow = Math.max(0, adjusted_cashflow || 0);
                adjusted_cashflows.push(adjusted_cashflow);
                console.log(`ç¬¬${i+1}å¹´æœ€ç»ˆè°ƒæ•´åç°é‡‘æµ: ${adjusted_cashflow}`);
            }

            console.log('è®¡ç®—è°ƒæ•´åæŠ•èµ„è€…ç°é‡‘æµ - è¾“å‡º:', adjusted_cashflows);
            console.log('ç°é‡‘æµæ€»é¢:', adjusted_cashflows.reduce((sum, cf) => sum + cf, 0));
            return adjusted_cashflows;
        }

        // æ‰§è¡Œé¡¹ç›®è´¢åŠ¡è®¡ç®—
        function performProjectCalculations(params) {
            console.log('=== å¼€å§‹é¡¹ç›®è´¢åŠ¡è®¡ç®— ===');
            console.log('é¡¹ç›®è®¡ç®—å‚æ•°:', params);
            console.log('æŠ•èµ„ç›¸å…³å‚æ•°æ£€æŸ¥:', {
                investment_share: params.investment_share,
                personal_tax_rate: params.personal_tax_rate,
                corporate_tax_rate: params.corporate_tax_rate,
                discount_rate: params.discount_rate
            });

            // è·å–å½“å‰æƒ…æ™¯çš„æ³¢åŠ¨å‚æ•°
            const currentScenario = getCurrentScenario();
            const volatility = currentScenario.volatility;

            // å•ç«™è®¡ç®—
            const daily_charging_hours = 24 * params.utilization_rate;
            const daily_revenue_per_station = params.guns_per_station * params.gun_power *
                                          daily_charging_hours * params.charging_price;
            const annual_revenue_per_station = daily_revenue_per_station * 365;

            // å•ç«™æˆæœ¬è®¡ç®—
            const annual_electricity_cost = params.guns_per_station * params.gun_power *
                                          daily_charging_hours * 365 * params.electricity_cost;
            const annual_opex_per_station = annual_electricity_cost + params.labor_cost +
                                           params.rent_cost + annual_revenue_per_station * 0.15; // å…¶ä»–è´¹ç”¨15%

            // é¡¹ç›®çº§è®¡ç®—
            const total_investment = params.total_stations * params.construction_cost * (1 - params.subsidy_rate);

            // 10å¹´ç°é‡‘æµé¢„æµ‹ï¼ˆè€ƒè™‘æƒ…æ™¯æ³¢åŠ¨ï¼‰
            const project_cashflows = [];  // é¡¹ç›®ç°é‡‘æµï¼ˆç¨åå‡€åˆ©æ¶¦ï¼‰
            const investor_cashflows = []; // æŠ•èµ„è€…ç°é‡‘æµï¼ˆç¨ååˆ†çº¢ï¼‰
            const yearly_details = [];

            for (let year = 1; year <= 10; year++) {
                // å¸‚åœºå¢é•¿å› ç´ 
                const market_growth = 1 + (params.growth_rate / 100);
                const cumulative_growth = Math.pow(market_growth, year - 1);

                // åº”ç”¨éšæœºæ³¢åŠ¨
                const revenue_volatility = getRandomInRange(volatility.revenue[0], volatility.revenue[1]);
                const cost_volatility = getRandomInRange(volatility.cost[0], volatility.cost[1]);
                const utilization_volatility = getRandomInRange(volatility.utilization[0], volatility.utilization[1]);

                // è°ƒæ•´åçš„åˆ©ç”¨ç‡
                const adjusted_utilization = params.utilization_rate * (1 + utilization_volatility);

                // å¹´åº¦æ”¶å…¥è®¡ç®—
                const year_revenue_per_station = params.guns_per_station * params.gun_power *
                                               (24 * adjusted_utilization) * params.charging_price * 365;
                const year_total_revenue = year_revenue_per_station * params.total_stations * cumulative_growth * (1 + revenue_volatility);

                // å¹´åº¦æˆæœ¬è®¡ç®—
                const year_electricity_cost = params.guns_per_station * params.gun_power *
                                             (24 * adjusted_utilization) * 365 * params.electricity_cost *
                                             params.total_stations * cumulative_growth * (1 + cost_volatility);

                const year_labor_cost = params.labor_cost * params.total_stations * Math.pow(1.05, year - 1); // äººå·¥æˆæœ¬å¹´å¢5%
                const year_rent_cost = params.rent_cost * params.total_stations * Math.pow(1.03, year - 1); // ç§Ÿé‡‘æˆæœ¬å¹´å¢3%
                const year_other_cost = year_total_revenue * 0.15; // å…¶ä»–è´¹ç”¨15%

                const year_total_cost = year_electricity_cost + year_labor_cost + year_rent_cost + year_other_cost;

                // ç¨å‰åˆ©æ¶¦
                const year_pre_tax_profit = year_total_revenue - year_total_cost;

                // ä¼ä¸šæ‰€å¾—ç¨
                const year_corporate_tax = Math.max(0, year_pre_tax_profit * params.corporate_tax_rate);

                // ç¨åå‡€åˆ©æ¶¦ï¼ˆé¡¹ç›®ç°é‡‘æµï¼‰
                const year_net_profit = year_pre_tax_profit - year_corporate_tax;

                // è®¡ç®—å¯åˆ†é…åˆ©æ¶¦ï¼ˆæ‰£é™¤èµ„æœ¬å…¬ç§¯åï¼‰
                const capital_surplus = year_net_profit * params.capital_surplus_rate;
                const distributable_profit = year_net_profit - capital_surplus;

                // æŠ•èµ„è€…åˆ†çº¢ï¼ˆåªæœ‰å¯åˆ†é…åˆ©æ¶¦ä¸ºæ­£æ•°æ—¶æ‰åˆ†çº¢ï¼‰
                const year_dividend = Math.max(0, distributable_profit) * params.distributable_profit_rate * params.investment_share;
                console.log(`ç¬¬${year}å¹´åˆ†çº¢: net_profit=${year_net_profit}, distributable_profit=${distributable_profit}, dividend=${year_dividend}`);

                project_cashflows.push(year_net_profit);
                investor_cashflows.push(year_dividend);
                yearly_details.push({
                    year: year,
                    revenue: year_total_revenue,
                    cost: year_total_cost,
                    pre_tax_profit: year_pre_tax_profit,
                    corporate_tax: year_corporate_tax,
                    net_profit: year_net_profit,
                    capital_surplus: capital_surplus,
                    distributable_profit: distributable_profit,
                    dividend: year_dividend,
                    utilization_rate: adjusted_utilization * 100
                });
            }

            // è®¡ç®—é¡¹ç›®IRRï¼ˆåŸºäºé¡¹ç›®ç°é‡‘æµï¼‰
            const project_all_cashflows = [-total_investment, ...project_cashflows];
            const irr = calculateIRR(project_all_cashflows);

            // è®¡ç®—é¡¹ç›®NPV
            const npv = calculateNPV(project_all_cashflows, params.discount_rate);

            // è®¡ç®—é¡¹ç›®æŠ•èµ„å›æ”¶æœŸï¼ˆåŸºäºé¡¹ç›®ç°é‡‘æµï¼‰
            let payback_period = 0;
            let cumulative = -total_investment;
            for (let year = 1; year <= 10; year++) {
                cumulative += project_cashflows[year - 1];
                if (cumulative >= 0) {
                    payback_period = year;
                    break;
                }
            }

            // 10å¹´ç´¯è®¡åˆ©æ¶¦å’Œåˆ†çº¢
            const total_10year_profit = yearly_details.reduce((sum, detail) => sum + detail.net_profit, 0);
            const total_10year_dividend = yearly_details.reduce((sum, detail) => sum + detail.dividend, 0);
            const total_10year_cost = yearly_details.reduce((sum, detail) => sum + detail.cost, 0);
            const total_10year_distributable_profit = yearly_details.reduce((sum, detail) => sum + detail.distributable_profit, 0);

            // å¹´å‡è®¡ç®—ï¼ˆç»Ÿä¸€ä½¿ç”¨10å¹´å¹³å‡å€¼ï¼‰
            const annual_net_profit = total_10year_profit / 10;
            const annual_cost = total_10year_cost / 10;
            const annual_revenue = annual_net_profit / (1 - params.corporate_tax_rate) + annual_cost;
            const annual_distributable_profit = total_10year_distributable_profit / 10;

            // æŠ•èµ„è€…å±‚é¢è®¡ç®—
            // 1. è®¡ç®—è€ƒè™‘æ—¶æœºçš„èµ„äº§ç°å€¼ï¼ˆåŸºäºæŠ•èµ„ä»½é¢ï¼‰
            const asset_present_value = calculateAssetPresentValue(total_investment * params.investment_share, params.investment_year, params.discount_rate);

            // 2. è®¡ç®—è€ƒè™‘æº¢ä»·çš„æŠ•èµ„ä»·æ ¼
            const premium_adjusted_price = asset_present_value * (1 + params.timing_premium);

            // 3. è®¡ç®—æŠ•èµ„è€…å®é™…æŠ•èµ„é¢ï¼ˆå·²ç»åŒ…å«æŠ•èµ„ä»½é¢ï¼Œæ‰€ä»¥ä¸å†ä¹˜ä»¥investment_shareï¼‰
            const actual_investment = premium_adjusted_price;

            // 4. è®¡ç®—æ¸ é“è´¹ç”¨
            const channel_costs = calculateChannelCosts(actual_investment, params);

            // 5. è®¡ç®—æ€»æŠ•å…¥æˆæœ¬
            const total_investor_cost = actual_investment + channel_costs.total_annual_costs;

            // 6. é‡æ–°è®¡ç®—æŠ•èµ„è€…ç°é‡‘æµï¼ˆè€ƒè™‘æ¸ é“åˆ†æˆï¼‰
            const adjusted_investor_cashflows = calculateAdjustedInvestorCashflows(investor_cashflows, params);

            // è®¡ç®—æŠ•èµ„è€…IRR
            const investor_all_cashflows = [-total_investor_cost, ...adjusted_investor_cashflows];
            const investor_irr = calculateIRR(investor_all_cashflows);

          
            // è®¡ç®—æŠ•èµ„è€…å›æ”¶æœŸ
            let investor_payback_period = 0;
            let investor_cumulative = -total_investor_cost;
            for (let year = 1; year <= 10; year++) {
                investor_cumulative += adjusted_investor_cashflows[year - 1];
                if (investor_cumulative >= 0) {
                    investor_payback_period = year;
                    break;
                }
            }

            // 10å¹´ç´¯è®¡ç¨ååˆ†çº¢ï¼ˆè°ƒæ•´åï¼‰
            const total_10year_after_tax_dividend = adjusted_investor_cashflows.reduce((sum, cf) => sum + cf, 0);

            // å¹´ç¨ååˆ†çº¢ï¼ˆä½¿ç”¨10å¹´å¹³å‡å€¼ï¼Œæ›´å…·ä»£è¡¨æ€§ï¼‰
            const annual_after_tax_dividend = total_10year_after_tax_dividend / 10;

            // æŠ•èµ„å›æŠ¥ç‡
            const roi = (total_10year_after_tax_dividend / total_investor_cost) * 100;

            // è®¡ç®—é¢å¤–æŒ‡æ ‡
            const premium_impact = ((premium_adjusted_price - total_investment) / total_investment) * 100;
            const channel_cost_impact = (channel_costs.total_annual_costs / actual_investment) * 100;
            const strategic_value = params.strategic_synergy ? params.strategic_synergy * 100 : 0;

            return {
                irr: irr,
                npv: npv,
                payback_period: payback_period,
                total_investment: total_investment,
                annual_revenue: annual_revenue,
                annual_cost: annual_cost,
                annual_distributable_profit: annual_distributable_profit,
                annual_after_tax_dividend: annual_after_tax_dividend,
                total_10year_profit: total_10year_profit,
                total_10year_dividend: total_10year_dividend,
                total_10year_after_tax_dividend: total_10year_after_tax_dividend,
                project_cashflows: project_cashflows,
                investor_cashflows: investor_cashflows,
                yearly_details: yearly_details
            };
        }

        // æ‰§è¡ŒæŠ•èµ„å›æŠ¥è®¡ç®—ï¼ˆåŸºäºé¡¹ç›®ç»“æœï¼‰
        function performInvestmentCalculations(params, projectResults) {
            console.log('å¼€å§‹æŠ•èµ„å›æŠ¥è®¡ç®—ï¼Œé¡¹ç›®ç»“æœ:', projectResults);
            console.log('æŠ•èµ„å‚æ•°:', params);

            try {
                // å‚æ•°éªŒè¯å’Œé»˜è®¤å€¼
                if (!projectResults || !projectResults.total_investment) {
                    console.error('é¡¹ç›®ç»“æœæ— æ•ˆ');
                    return getDefaultInvestmentResults();
                }

                if (!projectResults.investor_cashflows || projectResults.investor_cashflows.length === 0) {
                    console.error('æŠ•èµ„è€…ç°é‡‘æµæ•°æ®æ— æ•ˆ');
                    return getDefaultInvestmentResults();
                }

                // å®‰å…¨å‚æ•°å¤„ç†
                const safeParams = {
                    investment_year: params.investment_year || 1,
                    timing_premium: params.timing_premium || 0,
                    investment_share: params.investment_share || 0.01,
                    personal_tax_rate: params.personal_tax_rate,
                    investor_corporate_tax_rate: params.investor_corporate_tax_rate,
                    exchange_risk_premium: params.exchange_risk_premium || 0,
                    fund_management_fee: params.fund_management_fee || 0,
                    fund_carried_interest: params.fund_carried_interest || 0
                };

                console.log('å®‰å…¨å¤„ç†åçš„å‚æ•°:', safeParams);

                // 1. è®¡ç®—è€ƒè™‘æ—¶æœºçš„èµ„äº§ç°å€¼ï¼ˆåŸºäºæŠ•èµ„æ—¶ç‚¹æŠ˜ç°å’ŒæŠ•èµ„ä»½é¢ï¼‰
                const asset_present_value = calculateAssetPresentValue(
                    projectResults.total_investment * safeParams.investment_share,
                    safeParams.investment_year,
                    projectResults.discount_rate || 0.12
                );
                console.log('èµ„äº§ç°å€¼:', asset_present_value);

                // 2. è®¡ç®—è€ƒè™‘æº¢ä»·çš„æŠ•èµ„ä»·æ ¼ï¼ˆåæ˜ ä¸åŒæŠ•èµ„æ—¶ç‚¹çš„é£é™©å’Œæœºä¼šæˆæœ¬ï¼‰
                const premium_adjusted_price = asset_present_value * (1 + safeParams.timing_premium);
                console.log('æº¢ä»·è°ƒæ•´ä»·æ ¼:', premium_adjusted_price);

                // 3. è®¡ç®—æŠ•èµ„è€…å®é™…æŠ•èµ„é¢ï¼ˆå·²ç»åŒ…å«æŠ•èµ„ä»½é¢ï¼Œæ‰€ä»¥ä¸å†ä¹˜ä»¥investment_shareï¼‰
                const actual_investment = premium_adjusted_price;
                console.log('æŠ•èµ„è€…å®é™…æŠ•èµ„é¢:', actual_investment);

                // 4. è®¡ç®—æ¸ é“è´¹ç”¨
                const channel_costs = calculateChannelCosts(actual_investment, safeParams);
                console.log('æ¸ é“è´¹ç”¨:', channel_costs);

                // 5. è®¡ç®—æ€»æŠ•å…¥æˆæœ¬
                const total_investor_cost = actual_investment + (channel_costs.total_annual_costs || 0);
                console.log('æ€»æŠ•å…¥æˆæœ¬:', total_investor_cost);

                // 6. é‡æ–°è®¡ç®—æŠ•èµ„è€…ç°é‡‘æµï¼ˆè€ƒè™‘æ¸ é“åˆ†æˆï¼‰
                const adjusted_investor_cashflows = calculateAdjustedInvestorCashflows(
                    projectResults.investor_cashflows,
                    safeParams
                );
                console.log('è°ƒæ•´åæŠ•èµ„è€…ç°é‡‘æµ:', adjusted_investor_cashflows);

                // éªŒè¯ç°é‡‘æµæœ‰æ•ˆæ€§
                if (!adjusted_investor_cashflows || adjusted_investor_cashflows.length === 0) {
                    console.error('è°ƒæ•´åç°é‡‘æµæ— æ•ˆ');
                    return getDefaultInvestmentResults();
                }

                // 7. è®¡ç®—æŠ•èµ„è€…IRR
                const investor_all_cashflows = [-total_investor_cost, ...adjusted_investor_cashflows];
                const investor_irr = calculateIRR(investor_all_cashflows);
                console.log('æŠ•èµ„è€…IRR:', investor_irr);

                
                // 9. è®¡ç®—æŠ•èµ„è€…å›æ”¶æœŸ
                let investor_payback_period = 0;
                let investor_cumulative = -total_investor_cost;
                for (let year = 1; year <= 10; year++) {
                    investor_cumulative += adjusted_investor_cashflows[year - 1];
                    if (investor_cumulative >= 0) {
                        investor_payback_period = year;
                        break;
                    }
                }

                // 10. 10å¹´ç´¯è®¡ç¨ååˆ†çº¢ï¼ˆè°ƒæ•´åï¼‰
                const total_after_tax_dividend = adjusted_investor_cashflows.reduce((sum, cf) => sum + (cf || 0), 0);

                // 11. å¹´ç¨ååˆ†çº¢ï¼ˆä½¿ç”¨10å¹´å¹³å‡å€¼ï¼Œæ›´å…·ä»£è¡¨æ€§ï¼‰
                const annual_after_tax_dividend = total_after_tax_dividend / 10;

                // 12. æŠ•èµ„å›æŠ¥ç‡ï¼ˆé˜²æ­¢é™¤é›¶ï¼‰
                const roi = total_investor_cost > 0 ? (total_after_tax_dividend / total_investor_cost) * 100 : 0;

                const result = {
                    // æ ¸å¿ƒæŠ•èµ„æŒ‡æ ‡
                    asset_present_value: asset_present_value || 0,
                    investor_irr: investor_irr || 0,
                    investor_payback_period: investor_payback_period || 10,
                    actual_investment: total_investor_cost || 0,
                    annual_after_tax_dividend: annual_after_tax_dividend || 0,
                    roi: roi || 0,

                    // å…¶ä»–åˆ†ææŒ‡æ ‡ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
                    total_after_tax_dividend: total_after_tax_dividend || 0,
                    premium_adjusted_price: premium_adjusted_price || 0,
                    channel_costs: channel_costs || {}
                };

                console.log('æŠ•èµ„è®¡ç®—å®Œæˆï¼Œç»“æœ:', result);
                return result;

            } catch (error) {
                console.error('æŠ•èµ„è®¡ç®—è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
                return getDefaultInvestmentResults();
            }
        }

        // é»˜è®¤æŠ•èµ„ç»“æœï¼ˆå½“è®¡ç®—å¤±è´¥æ—¶ä½¿ç”¨ï¼‰
        function getDefaultInvestmentResults() {
            return {
                asset_present_value: 0,
                investor_irr: 0,
                investor_payback_period: 10,
                actual_investment: 0,
                annual_after_tax_dividend: 0,
                roi: 0,
                total_after_tax_dividend: 0,
                premium_adjusted_price: 0,
                channel_costs: {}
            };
        }

        // è·å–éšæœºæ•°ï¼ˆç”¨äºæ¨¡æ‹Ÿæ³¢åŠ¨ï¼‰
        function getRandomInRange(min, max) {
            return Math.random() * (max - min) + min;
        }

        // è·å–å½“å‰æƒ…æ™¯å‚æ•°
        function getCurrentScenario() {
            // æ ¹æ®å½“å‰å‚æ•°å€¼åˆ¤æ–­å±äºå“ªç§æƒ…æ™¯
            const utilization_rate = parseFloat(document.getElementById('utilization_rate').value);
            const charging_price = parseFloat(document.getElementById('charging_price').value);

            if (utilization_rate <= 25 && charging_price <= 0.8) {
                return scenarios.conservative;
            } else if (utilization_rate >= 35 && charging_price >= 1.1) {
                return scenarios.optimistic;
            } else {
                return scenarios.base;
            }
        }

        // è®¡ç®—IRR
        function calculateIRR(cashflows) {
            // ç®€åŒ–çš„IRRè®¡ç®—ï¼ˆäºŒåˆ†æ³•ï¼‰
            let low = 0;
            let high = 1;
            let mid = 0;

            for (let i = 0; i < 100; i++) {
                mid = (low + high) / 2;
                let npv = 0;

                for (let j = 0; j < cashflows.length; j++) {
                    npv += cashflows[j] / Math.pow(1 + mid, j);
                }

                if (Math.abs(npv) < 1000) {
                    break;
                }

                if (npv > 0) {
                    low = mid;
                } else {
                    high = mid;
                }
            }

            return mid * 100; // è½¬æ¢ä¸ºç™¾åˆ†æ¯”
        }

        // è®¡ç®—NPV
        function calculateNPV(cashflows, discount_rate) {
            let npv = 0;
            for (let i = 0; i < cashflows.length; i++) {
                npv += cashflows[i] / Math.pow(1 + discount_rate, i);
            }
            return npv;
        }

        // æ›´æ–°é¡¹ç›®è®¡ç®—åçš„UIçŠ¶æ€
        function updateProjectCalculationUI(results) {
            // æ˜¾ç¤ºé¡¹ç›®å…³é”®æ—¶ç‚¹ä¿¡æ¯
            document.getElementById('project-timing-info').style.display = 'block';
            document.getElementById('project_payback_display').textContent = results.payback_period.toFixed(1) + 'å¹´';
            document.getElementById('project_irr_display').textContent = results.irr.toFixed(1) + '%';
            document.getElementById('project_npv_display').textContent = (results.npv / 100000000).toFixed(1) + 'äº¿';

            // æ›´æ–°æŠ•èµ„æ—¶æœºçš„é»˜è®¤å€¼ï¼ˆåŸºäºé¡¹ç›®å›æ”¶æœŸï¼‰
            updateInvestmentTimingBasedOnProject(results);

            // æ›´æ–°çŠ¶æ€æç¤º
            const statusElement = document.getElementById('calculation_status');
            const statusText = statusElement.querySelector('.status-text');
            statusText.textContent = 'âœ… é¡¹ç›®åˆ†æå®Œæˆï¼Œå¯ä»¥è°ƒæ•´æŠ•èµ„å‚æ•°è¿›è¡Œå¤šæ–¹æ¡ˆå¯¹æ¯”åˆ†æ';
            statusText.className = 'status-text success';
        }

        // åŸºäºé¡¹ç›®ç»“æœæ›´æ–°æŠ•èµ„æ—¶æœºå‚æ•°
        function updateInvestmentTimingBasedOnProject(results) {
            // ä»…æ˜¾ç¤ºæŠ•èµ„æ—¶ç‚¹é¢„è§ˆï¼ˆä¸å®é™…åº”ç”¨å‚æ•°ï¼‰
            displayInvestmentTimingPreview(results);

            // æ›´æ–°å›æœ¬æœŸæº¢ä»·ï¼ˆåŸºäºé¡¹ç›®IRRï¼‰
            const paybackPremium = Math.min(results.irr - 15, 50); // ä»¥15%ä¸ºåŸºå‡†ï¼Œæœ€é«˜50%
            const paybackPremiumElement = document.getElementById('payback_premium');
            if (paybackPremiumElement) {
                paybackPremiumElement.value = Math.max(paybackPremium, 10).toFixed(1);
            }
        }

        // æ ¹æ®æŠ•èµ„æ—¶ç‚¹ç±»å‹æ›´æ–°æŠ•èµ„å¹´ä»½
        function updateInvestmentTimingByType(projectResults) {
            const timingType = document.getElementById('investment_timing').value;
            let investmentYear = 1; // é»˜è®¤å€¼
            let hintText = '';

            switch(timingType) {
                case 'preparation':
                    investmentYear = 1; // ç­¹å¤‡æœŸï¼šç¬¬1å¹´
                    hintText = 'ç­¹å¤‡æœŸæŠ•èµ„æ—¶ç‚¹ï¼šç¬¬1å¹´';
                    break;
                case 'production':
                    investmentYear = 2; // æŠ•äº§æœŸï¼šç¬¬2å¹´
                    hintText = 'æŠ•äº§æœŸæŠ•èµ„æ—¶ç‚¹ï¼šç¬¬2å¹´';
                    break;
                case 'payback':
                    investmentYear = projectResults.payback_period; // å›æŠ¥æœŸï¼šé¡¹ç›®è®¡ç®—å›æ”¶æœŸ
                    hintText = `å›æŠ¥æœŸæŠ•èµ„æ—¶ç‚¹ï¼šç¬¬${projectResults.payback_period.toFixed(1)}å¹´ï¼ˆé¡¹ç›®å›æ”¶æœŸï¼‰`;
                    break;
                case 'listing':
                    investmentYear = projectResults.payback_period + 2; // IPOï¼šå›æŠ¥æœŸå2å¹´
                    hintText = `IPOæŠ•èµ„æ—¶ç‚¹ï¼šç¬¬${(projectResults.payback_period + 2).toFixed(1)}å¹´ï¼ˆå›æ”¶æœŸå2å¹´ï¼‰`;
                    break;
                case 'securitization':
                    investmentYear = projectResults.payback_period + 5; // è¯åˆ¸åŒ–ï¼šå›æŠ¥æœŸå5å¹´
                    hintText = `è¯åˆ¸åŒ–æŠ•èµ„æ—¶ç‚¹ï¼šç¬¬${(projectResults.payback_period + 5).toFixed(1)}å¹´ï¼ˆå›æ”¶æœŸå5å¹´ï¼‰`;
                    break;
                default:
                    investmentYear = 1;
                    hintText = 'é»˜è®¤æŠ•èµ„æ—¶ç‚¹ï¼šç¬¬1å¹´';
            }

            // æ›´æ–°æŠ•èµ„å¹´ä»½è¾“å…¥æ¡†
            document.getElementById('investment_year').value = investmentYear.toFixed(1);

            // æ›´æ–°æ—¶ç‚¹æç¤º
            const hintElement = document.getElementById('timing_hint');
            if (hintElement) {
                hintElement.textContent = hintText;
            }

            console.log(`æŠ•èµ„æ—¶ç‚¹æ›´æ–°: ${timingType} -> ç¬¬${investmentYear.toFixed(1)}å¹´`);
        }

        // ç›‘å¬æŠ•èµ„æ—¶æœºå˜åŒ–ï¼Œä»…æ˜¾ç¤ºå¯¹åº”çš„å¹´æ•°ï¼ˆä¸æ›´æ–°å®é™…è®¡ç®—å‚æ•°ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            const investmentTimingSelect = document.getElementById('investment_timing');
            if (investmentTimingSelect) {
                investmentTimingSelect.addEventListener('change', function() {
                    // å¦‚æœé¡¹ç›®è®¡ç®—å·²å®Œæˆï¼Œä»…æ˜¾ç¤ºå¯¹åº”çš„å¹´æ•°
                    if (window.projectCalculationResults) {
                        displayInvestmentTimingPreview(window.projectCalculationResults);
                    }
                });
            }
        });

        // ä»…æ˜¾ç¤ºæŠ•èµ„æ—¶ç‚¹é¢„è§ˆå¹´æ•°ï¼ˆä¸æ›´æ–°å®é™…å‚æ•°ï¼‰
        function displayInvestmentTimingPreview(projectResults) {
            const timingType = document.getElementById('investment_timing').value;
            let investmentYear = 1; // é»˜è®¤å€¼
            let hintText = '';

            switch(timingType) {
                case 'preparation':
                    investmentYear = 1; // ç­¹å¤‡æœŸï¼šç¬¬1å¹´
                    hintText = `ç­¹å¤‡æœŸæŠ•èµ„æ—¶ç‚¹ï¼šç¬¬${investmentYear}å¹´`;
                    break;
                case 'production':
                    investmentYear = 2; // æŠ•äº§æœŸï¼šç¬¬2å¹´
                    hintText = `æŠ•äº§æœŸæŠ•èµ„æ—¶ç‚¹ï¼šç¬¬${investmentYear}å¹´`;
                    break;
                case 'payback':
                    investmentYear = projectResults.payback_period; // å›æŠ¥æœŸï¼šé¡¹ç›®è®¡ç®—å›æ”¶æœŸ
                    hintText = `å›æŠ¥æœŸæŠ•èµ„æ—¶ç‚¹ï¼šç¬¬${investmentYear.toFixed(1)}å¹´ï¼ˆé¡¹ç›®å›æ”¶æœŸï¼‰`;
                    break;
                case 'listing':
                    investmentYear = projectResults.payback_period + 2; // IPOï¼šå›æŠ¥æœŸå2å¹´
                    hintText = `IPOæŠ•èµ„æ—¶ç‚¹ï¼šç¬¬${investmentYear.toFixed(1)}å¹´ï¼ˆå›æ”¶æœŸå2å¹´ï¼‰`;
                    break;
                case 'securitization':
                    investmentYear = projectResults.payback_period + 5; // è¯åˆ¸åŒ–ï¼šå›æŠ¥æœŸå5å¹´
                    hintText = `è¯åˆ¸åŒ–æŠ•èµ„æ—¶ç‚¹ï¼šç¬¬${investmentYear.toFixed(1)}å¹´ï¼ˆå›æ”¶æœŸå5å¹´ï¼‰`;
                    break;
                default:
                    investmentYear = 1;
                    hintText = 'é»˜è®¤æŠ•èµ„æ—¶ç‚¹ï¼šç¬¬1å¹´';
            }

            // ä»…æ›´æ–°æ˜¾ç¤ºï¼Œä¸æ›´æ–°å®é™…çš„æŠ•èµ„å¹´ä»½è¾“å…¥æ¡†
            const hintElement = document.getElementById('timing_hint');
            if (hintElement) {
                hintElement.textContent = hintText + ' (ç‚¹å‡»"è®¡ç®—æŠ•èµ„å›æŠ¥"åº”ç”¨æ­¤è®¾ç½®)';
            }

            console.log(`æŠ•èµ„æ—¶ç‚¹é¢„è§ˆ: ${timingType} -> ç¬¬${investmentYear.toFixed(1)}å¹´ (ä»…æ˜¾ç¤ºï¼Œæœªåº”ç”¨)`);
        }

        // å¯ç”¨æŠ•èµ„è®¡ç®—æŒ‰é’®
        function enableInvestmentCalculation() {
            document.getElementById('investment_calc_btn').disabled = false;
        }

        // æ˜¾ç¤ºé¡¹ç›®ç»“æœ
        function displayProjectResults(results) {
            // é¡¹ç›®åˆ†æç»“æœ
            document.getElementById('irr_result').textContent = results.irr.toFixed(1) + '%';
            document.getElementById('npv_result').textContent = (results.npv / 100000000).toFixed(1) + 'äº¿';
            document.getElementById('total_investment_result').textContent = (results.total_investment / 100000000).toFixed(1) + 'äº¿';
            document.getElementById('payback_result').textContent = results.payback_period.toFixed(1) + 'å¹´';
            document.getElementById('annual_revenue_result').textContent = (results.annual_revenue / 100000000).toFixed(1) + 'äº¿';
            document.getElementById('annual_cost_result').textContent = (results.annual_cost / 100000000).toFixed(1) + 'äº¿';
            document.getElementById('annual_distributable_profit_result').textContent = (results.annual_distributable_profit / 100000000).toFixed(1) + 'äº¿';
            document.getElementById('total_profit_result').textContent = (results.total_10year_profit / 100000000).toFixed(1) + 'äº¿';
        }

        // æ˜¾ç¤ºæŠ•èµ„ç»“æœ
        function displayInvestmentResults(results) {
            console.log('å¼€å§‹æ˜¾ç¤ºæŠ•èµ„ç»“æœ:', results);
            console.log('å…³é”®æ•°æ®æ£€æŸ¥:', {
                investor_irr: results.investor_irr,
                annual_after_tax_dividend: results.annual_after_tax_dividend,
                total_after_tax_dividend: results.total_after_tax_dividend,
                asset_present_value: results.asset_present_value,
                actual_investment: results.actual_investment
            });

            // æ˜¾ç¤ºæŠ•èµ„ç»“æœæ¨¡å—
            const investmentSection = document.getElementById('investment-results-section');
            if (investmentSection) {
                investmentSection.style.display = 'block';
            }

            // æ ¸å¿ƒæŠ•èµ„æŒ‡æ ‡
            const elements = {
                'investor_irr_result': results.investor_irr ? results.investor_irr.toFixed(1) + '%' : '--%',
                'asset_present_value_result': (results.asset_present_value / 100000000).toFixed(1) + 'äº¿',
                'actual_investment_result': (results.actual_investment / 100000000).toFixed(1) + 'äº¿',
                'investor_payback_result': results.investor_payback_period ? results.investor_payback_period.toFixed(1) + 'å¹´' : '--å¹´',
                'after_tax_dividend_result': (results.annual_after_tax_dividend / 100000000).toFixed(2) + 'äº¿',
                'total_investor_profit_result': results.total_after_tax_dividend ? (results.total_after_tax_dividend / 100000000).toFixed(1) + 'äº¿' : '--äº¿'
            };

            for (const [id, value] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                    console.log(`è®¾ç½® ${id}: ${value}`);
                } else {
                    console.error(`æ‰¾ä¸åˆ°å…ƒç´ : ${id}`);
                }
            }

            // æ»šåŠ¨åˆ°æŠ•èµ„ç»“æœåŒºåŸŸ
            if (investmentSection) {
                investmentSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // æ›´æ–°æŠ•èµ„è®¡ç®—åçš„UIçŠ¶æ€
        function updateInvestmentCalculationUI(results) {
            const statusElement = document.getElementById('calculation_status');
            const statusText = statusElement.querySelector('.status-text');
            statusText.textContent = 'âœ… æŠ•èµ„å›æŠ¥åˆ†æå®Œæˆï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹ç»“æœ';
            statusText.className = 'status-text success';
        }

        // æ˜¾ç¤ºç»“æœï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰
        function displayResults(results) {
            // å¦‚æœæœ‰é¡¹ç›®ç»“æœï¼Œæ˜¾ç¤ºé¡¹ç›®åˆ†æç»“æœ
            if (results.irr !== undefined) {
                document.getElementById('irr_result').textContent = results.irr.toFixed(1) + '%';
                document.getElementById('npv_result').textContent = (results.npv / 100000000).toFixed(1) + 'äº¿';
                document.getElementById('payback_result').textContent = results.payback_period.toFixed(1) + 'å¹´';
                document.getElementById('total_investment_result').textContent = (results.total_investment / 100000000).toFixed(1) + 'äº¿';
                document.getElementById('annual_revenue_result').textContent = (results.annual_revenue / 100000000).toFixed(1) + 'äº¿';
                document.getElementById('total_profit_result').textContent = (results.total_10year_profit / 100000000).toFixed(1) + 'äº¿';
            }

            // å¦‚æœæœ‰æŠ•èµ„ç»“æœï¼Œæ˜¾ç¤ºæŠ•èµ„å›æŠ¥åˆ†æ
            if (results.asset_present_value !== undefined) {
                // æ˜¾ç¤ºæŠ•èµ„ç»“æœæ¨¡å—
                document.getElementById('investment-results-section').style.display = 'block';

                document.getElementById('asset_present_value_result').textContent = (results.asset_present_value / 100000000).toFixed(1) + 'äº¿';
                document.getElementById('investor_irr_result').textContent = results.investor_irr.toFixed(1) + '%';
                document.getElementById('investor_payback_result').textContent = results.investor_payback_period.toFixed(1) + 'å¹´';
                document.getElementById('actual_investment_result').textContent = (results.actual_investment / 100000000).toFixed(1) + 'äº¿';
                document.getElementById('after_tax_dividend_result').textContent = (results.annual_after_tax_dividend / 100000000).toFixed(2) + 'äº¿';
                document.getElementById('roi_result').textContent = results.roi.toFixed(0) + '%';
            }
        }

        // æ›´æ–°ç°é‡‘æµå›¾è¡¨
        function updateCashflowChart(project_cashflows) {
            const chartContainer = document.getElementById('cashflow_chart');
            chartContainer.innerHTML = '';

            // å¤„ç†è´Ÿå€¼ï¼Œä½¿ç”¨ç»å¯¹å€¼è®¡ç®—é«˜åº¦
            const maxAbsValue = Math.max(...project_cashflows.map(Math.abs), 1);
            const hasNegative = project_cashflows.some(cf => cf < 0);

            project_cashflows.forEach((cashflow, index) => {
                const year = index + 1;
                const barHeight = Math.abs(cashflow / maxAbsValue) * 160;

                const bar = document.createElement('div');
                bar.className = 'bar';

                // å¦‚æœæœ‰è´Ÿå€¼ï¼Œè°ƒæ•´å›¾è¡¨æ˜¾ç¤º
                if (hasNegative) {
                    if (cashflow >= 0) {
                        bar.style.height = barHeight + 'px';
                        bar.style.marginTop = '0px';
                    } else {
                        bar.style.height = barHeight + 'px';
                        bar.style.marginTop = barHeight + 'px';
                        bar.style.background = 'linear-gradient(to bottom, #FFC72C, #FF6B6B)';
                    }
                } else {
                    bar.style.height = barHeight + 'px';
                }

                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = `ç¬¬${year}å¹´`;

                const value = document.createElement('div');
                value.className = 'bar-value';
                value.textContent = (cashflow / 100000000).toFixed(1) + 'äº¿';
                if (cashflow < 0) {
                    value.style.color = '#FF6B6B';
                }

                bar.appendChild(value);
                bar.appendChild(label);
                chartContainer.appendChild(bar);
            });

            // æ·»åŠ é›¶è½´çº¿ï¼ˆå¦‚æœæœ‰è´Ÿå€¼ï¼‰
            if (hasNegative) {
                const zeroLine = document.createElement('div');
                zeroLine.style.cssText = `
                    position: absolute;
                    bottom: 50%;
                    left: 0;
                    right: 0;
                    height: 2px;
                    background: #FFC72C;
                    z-index: 1;
                `;
                chartContainer.style.position = 'relative';
                chartContainer.appendChild(zeroLine);
            }
        }
    </script>
</body>
</html>
